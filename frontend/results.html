<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<title>è€ƒè¯•æˆç»© - IMBA æ™ºèƒ½è€ƒè¯•ç³»ç»Ÿ</title>
<script src="https://cdn.tailwindcss.com/3.4.16"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css" rel="stylesheet">
<script>
tailwind.config = {
theme: {
extend: {
colors: {
primary: '#1A237E',
secondary: '#3F51B5'
},
fontFamily: {
'sans': ['Inter', 'system-ui', 'sans-serif']
}
}
}
}
</script>
<style>
body {
font-family: 'Inter', sans-serif;
background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
}

.grade-circle {
width: 140px;
height: 140px;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
font-size: 2.5rem;
font-weight: bold;
color: white;
position: relative;
}

.grade-a { background: linear-gradient(135deg, #10b981, #059669); }
.grade-b { background: linear-gradient(135deg, #3b82f6, #2563eb); }
.grade-c { background: linear-gradient(135deg, #f59e0b, #d97706); }
.grade-d { background: linear-gradient(135deg, #ef4444, #dc2626); }
.grade-f { background: linear-gradient(135deg, #6b7280, #4b5563); }

.score-card {
transition: all 0.3s ease;
background: white;
border-radius: 16px;
}

.score-card:hover {
transform: translateY(-2px);
box-shadow: 0 10px 25px rgba(0,0,0,0.1);
}

.fade-in {
animation: fadeIn 0.8s ease-out;
}

@keyframes fadeIn {
0% { opacity: 0; transform: translateY(20px); }
100% { opacity: 1; transform: translateY(0); }
}

.score-animation {
animation: scoreCount 1.5s ease-out;
}

@keyframes scoreCount {
0% { transform: scale(0.8); opacity: 0; }
100% { transform: scale(1); opacity: 1; }
}

.progress-bar {
height: 8px;
background: #e5e7eb;
border-radius: 4px;
overflow: hidden;
}

.progress-fill {
height: 100%;
background: linear-gradient(90deg, #3b82f6, #1d4ed8);
border-radius: 4px;
transition: width 1.5s ease-out;
}
</style>
</head>

<body class="min-h-screen">
<!-- Header -->
<div class="bg-white shadow-sm border-b">
<div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
<div class="flex items-center justify-between h-16">
<div class="flex items-center space-x-3">
<img src="https://static.readdy.ai/image/3c1ff9a008dc8b425236e4faed5d7924/c0ad19844b74c75ecb76a8cc5a6f9bd3.jfif" alt="IMBA Logo" class="w-8 h-8 object-contain">
<div class="font-bold text-lg text-primary">IMBA æ™ºèƒ½è€ƒè¯•</div>
</div>
<div class="flex items-center space-x-4">
<a href="/" class="text-gray-600 hover:text-primary transition-colors">
<i class="ri-home-line mr-2"></i>è¿”å›é¦–é¡µ
</a>
</div>
</div>
</div>
</div>

<!-- Main Content -->
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
<!-- Loading State -->
<div id="loadingState" class="text-center">
<div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-4"></div>
<p class="text-gray-600">æ­£åœ¨åŠ è½½æˆç»©...</p>
</div>

<!-- Error State -->
<div id="errorState" class="hidden text-center">
<div class="inline-flex items-center justify-center w-16 h-16 bg-red-100 rounded-full mb-4">
<i class="ri-error-warning-line text-red-600 text-2xl"></i>
</div>
<h2 class="text-2xl font-bold text-gray-900 mb-2">åŠ è½½å¤±è´¥</h2>
<p class="text-gray-600 mb-6">æ— æ³•åŠ è½½è€ƒè¯•æˆç»©ï¼Œè¯·ç¨åé‡è¯•ã€‚</p>
<button onclick="window.location.reload()" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-blue-800 transition-colors">
é‡æ–°åŠ è½½
</button>
</div>

<!-- Results Content -->
<div id="resultsContent" class="hidden">
<!-- Overall Score -->
<div class="text-center mb-12 fade-in">
<div class="inline-block mb-6">
<div id="gradeCircle" class="grade-circle grade-a mx-auto score-animation">
A+
</div>
</div>
<h1 class="text-4xl font-bold text-gray-900 mb-4">è€ƒè¯•æˆç»©</h1>
<p class="text-xl text-gray-600 mb-8">æ­å–œæ‚¨å®Œæˆè€ƒè¯•ï¼ä»¥ä¸‹æ˜¯æ‚¨çš„æˆç»©è¯¦æƒ…</p>

<!-- Score Summary -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
<div class="score-card p-8">
<div class="text-4xl font-bold text-primary mb-2 score-animation" id="totalScore">85</div>
<div class="text-gray-600 mb-4">æ€»åˆ†</div>
<div class="progress-bar">
<div class="progress-fill" id="totalProgressFill" style="width: 0%"></div>
</div>
</div>
<div class="score-card p-8">
<div class="text-4xl font-bold text-green-600 mb-2 score-animation" id="percentageScore">85%</div>
<div class="text-gray-600 mb-4">æ­£ç¡®ç‡</div>
<div class="progress-bar">
<div class="progress-fill bg-gradient-to-r from-green-500 to-green-600" id="percentageProgressFill" style="width: 0%"></div>
</div>
</div>
<div class="score-card p-8">
<div class="text-4xl font-bold text-blue-600 mb-2 score-animation" id="grade">A</div>
<div class="text-gray-600">ç­‰çº§</div>
<div class="text-sm text-gray-500 mt-2" id="gradeDescription">ä¼˜ç§€</div>
</div>
</div>
</div>

<!-- Question Analysis -->
<div class="score-card p-8 mb-8 fade-in">
<h3 class="text-2xl font-bold text-gray-900 mb-6">ç­”é¢˜åˆ†æ</h3>
<div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-6">
<div class="text-center">
<div class="text-3xl font-bold text-gray-900" id="totalQuestions">5</div>
<div class="text-sm text-gray-600">æ€»é¢˜æ•°</div>
</div>
<div class="text-center">
<div class="text-3xl font-bold text-green-600" id="correctAnswers">4</div>
<div class="text-sm text-gray-600">ç­”å¯¹</div>
</div>
<div class="text-center">
<div class="text-3xl font-bold text-red-600" id="wrongAnswers">1</div>
<div class="text-sm text-gray-600">ç­”é”™</div>
</div>
<div class="text-center">
<div class="text-3xl font-bold text-blue-600" id="timeSpent">45åˆ†</div>
<div class="text-sm text-gray-600">ç”¨æ—¶</div>
</div>
</div>

<!-- Question Details -->
<div id="questionDetails" class="space-y-4">
<!-- åŠ¨æ€ç”Ÿæˆé¢˜ç›®è¯¦æƒ… -->
</div>
</div>

<!-- Performance Summary -->
<div class="score-card p-8 mb-8 fade-in">
<h3 class="text-2xl font-bold text-gray-900 mb-6">æˆç»©æ€»ç»“</h3>
<div class="bg-blue-50 rounded-xl p-6 mb-6">
<div class="flex items-start">
<i class="ri-lightbulb-line text-blue-600 text-2xl mr-4 flex-shrink-0 mt-1"></i>
<div>
<h4 class="font-semibold text-blue-900 mb-2">æ€»ä½“è¯„ä»·</h4>
<p id="overallSummary" class="text-blue-800">æ‚¨åœ¨æœ¬æ¬¡è€ƒè¯•ä¸­è¡¨ç°ä¼˜ç§€ï¼Œå±•ç°äº†æ‰å®çš„åŸºç¡€çŸ¥è¯†å’Œè‰¯å¥½çš„åº”ç”¨èƒ½åŠ›ã€‚</p>
</div>
</div>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div class="bg-green-50 rounded-xl p-6">
<h4 class="font-semibold text-green-900 mb-3 flex items-center">
<i class="ri-thumb-up-line mr-2"></i>è¡¨ç°ä¼˜å¼‚
</h4>
<div id="strengths" class="space-y-2">
<!-- åŠ¨æ€ç”Ÿæˆä¼˜åŠ¿ -->
</div>
</div>
<div class="bg-yellow-50 rounded-xl p-6">
<h4 class="font-semibold text-yellow-900 mb-3 flex items-center">
<i class="ri-lightbulb-line mr-2"></i>æ”¹è¿›å»ºè®®
</h4>
<div id="improvements" class="space-y-2">
<!-- åŠ¨æ€ç”Ÿæˆå»ºè®® -->
</div>
</div>
</div>
</div>

<!-- Actions -->
<div class="text-center fade-in">
<div class="flex flex-col sm:flex-row gap-4 justify-center">
<button onclick="window.print()" class="bg-primary text-white px-8 py-3 rounded-xl font-semibold hover:bg-blue-800 transition-colors">
<i class="ri-printer-line mr-2"></i>æ‰“å°æˆç»©å•
</button>
<button onclick="window.location.href='/'" class="bg-gray-600 text-white px-8 py-3 rounded-xl font-semibold hover:bg-gray-700 transition-colors">
<i class="ri-home-line mr-2"></i>è¿”å›é¦–é¡µ
</button>
</div>
</div>
</div>
</div>

<script>
class ResultsDisplay {
constructor() {
this.examData = null;
this.scores = null;
this.init();
}

async init() {
try {
await this.loadResults();
this.hideLoading();
this.showResults();
this.renderResults();
this.animateProgress();
} catch (error) {
this.hideLoading();
this.showError();
}
}

async loadResults() {
// ä»URLè·å–è€ƒè¯•ID
const pathParts = window.location.pathname.split('/');
const examId = pathParts[pathParts.length - 1];
console.log('åŠ è½½è€ƒè¯•ç»“æœï¼Œè€ƒè¯•ID:', examId);

// åŠ è½½è€ƒè¯•ç»“æœ (æ·»åŠ ç¼“å­˜ç ´åå‚æ•°)
const timestamp = new Date().getTime();
const response = await fetch(`/api/exam-results/${examId}?t=${timestamp}`, {
cache: 'no-cache',
headers: {
'Cache-Control': 'no-cache',
'Pragma': 'no-cache'
}
});

if (!response.ok) {
throw new Error(`åŠ è½½ç»“æœå¤±è´¥: ${response.status}`);
}

const data = await response.json();
console.log('APIè¿”å›æ•°æ®:', data);

if (!data.success) {
throw new Error(`APIè¿”å›é”™è¯¯: ${data.message}`);
}

this.examData = data.exam;
this.scores = data.scores;
console.log('âœ… æˆåŠŸåŠ è½½çœŸå®è¯„åˆ†æ•°æ®:', this.scores);

// æ£€æŸ¥æ˜¯å¦æœ‰æœ‰æ•ˆçš„åˆ†æ•°æ•°æ®
if (!this.scores || Object.keys(this.scores).length === 0) {
throw new Error('æ²¡æœ‰åˆ†æ•°æ•°æ®');
}
}

hideLoading() {
document.getElementById('loadingState').classList.add('hidden');
}

showError() {
document.getElementById('errorState').classList.remove('hidden');
}

showResults() {
document.getElementById('resultsContent').classList.remove('hidden');
}

renderResults() {
const totalScore = this.scores.total_score || 0;
const maxScore = this.scores.max_score || 1;
const percentageScore = this.scores.percentage_score || 0;
const grade = this.scores.grade || 'N/A';

console.log(`ğŸ“Š æ¸²æŸ“åˆ†æ•°: æ€»åˆ†=${totalScore}, ç™¾åˆ†æ¯”=${percentageScore}%, ç­‰çº§=${grade}`);

// æ›´æ–°æ€»ä½“åˆ†æ•°
document.getElementById('totalScore').textContent = `${totalScore}/${maxScore}`;
document.getElementById('percentageScore').textContent = percentageScore + '%';
document.getElementById('grade').textContent = grade;

// æ›´æ–°ç­‰çº§åœ†åœˆ
const gradeCircle = document.getElementById('gradeCircle');
gradeCircle.textContent = grade;
const gradeClass = grade ? grade.charAt(0).toLowerCase() : 'f';
gradeCircle.className = `grade-circle grade-${gradeClass} mx-auto score-animation`;

// æ›´æ–°ç­‰çº§æè¿°
document.getElementById('gradeDescription').textContent = this.getGradeDescription(grade);

// æ›´æ–°ç­”é¢˜åˆ†æ
this.updateQuestionAnalysis();

// æ›´æ–°æˆç»©æ€»ç»“
this.updateSummary();
}

getGradeDescription(grade) {
const descriptions = {
'A+': 'å“è¶Š', 'A': 'ä¼˜ç§€', 'A-': 'ä¼˜è‰¯',
'B+': 'è‰¯å¥½', 'B': 'è‰¯å¥½', 'B-': 'ä¸­ä¸Š',
'C+': 'ä¸­ç­‰', 'C': 'ä¸­ç­‰', 'C-': 'ä¸­ä¸‹',
'D': 'åŠæ ¼', 'F': 'ä¸åŠæ ¼'
};
return descriptions[grade] || 'æœªçŸ¥';
}

updateQuestionAnalysis() {
const questionScores = this.scores.question_scores || [];
const totalQuestions = questionScores.length;
const correctAnswers = questionScores.filter(q => q.percentage >= 80).length;
const wrongAnswers = totalQuestions - correctAnswers;

document.getElementById('totalQuestions').textContent = totalQuestions;
document.getElementById('correctAnswers').textContent = correctAnswers;
document.getElementById('wrongAnswers').textContent = wrongAnswers;
document.getElementById('timeSpent').textContent = this.calculateTimeSpent();

// ç”Ÿæˆé¢˜ç›®è¯¦æƒ…
const detailsContainer = document.getElementById('questionDetails');
detailsContainer.innerHTML = '';

questionScores.forEach((question, index) => {
const isCorrect = question.percentage >= 80;
const isPartial = question.percentage >= 40 && question.percentage < 80;

const statusIcon = isCorrect ? 'ri-check-circle-fill text-green-500' : 
                   isPartial ? 'ri-checkbox-circle-fill text-yellow-500' : 
                   'ri-close-circle-fill text-red-500';

const statusText = isCorrect ? 'æ­£ç¡®' : 
                   isPartial ? 'éƒ¨åˆ†æ­£ç¡®' : 
                   'é”™è¯¯';

const statusColor = isCorrect ? 'text-green-600' : 
                    isPartial ? 'text-yellow-600' : 
                    'text-red-600';

const questionDiv = document.createElement('div');
questionDiv.className = 'bg-gray-50 rounded-lg p-4';
questionDiv.innerHTML = `
<div class="flex items-center justify-between">
<div class="flex items-center space-x-3">
<i class="${statusIcon} text-xl"></i>
<div>
<span class="font-medium text-gray-900">ç¬¬ ${index + 1} é¢˜</span>
<span class="text-sm text-gray-500 ml-2">${question.question_type}</span>
</div>
</div>
<div class="text-right">
<div class="font-semibold ${statusColor}">${question.score.toFixed(1)}/${question.max_score.toFixed(1)}</div>
<div class="text-sm text-gray-500">${question.percentage.toFixed(0)}%</div>
</div>
</div>
`;
detailsContainer.appendChild(questionDiv);
});
}

updateSummary() {
const percentageScore = this.scores.percentage_score || 0;
let summary = '';

if (percentageScore >= 90) {
summary = 'æ‚¨åœ¨æœ¬æ¬¡è€ƒè¯•ä¸­è¡¨ç°å“è¶Šï¼Œå±•ç°äº†æ·±åšçš„çŸ¥è¯†åŠŸåº•å’Œä¼˜ç§€çš„åº”ç”¨èƒ½åŠ›ã€‚';
} else if (percentageScore >= 80) {
summary = 'æ‚¨åœ¨æœ¬æ¬¡è€ƒè¯•ä¸­è¡¨ç°ä¼˜ç§€ï¼ŒåŸºç¡€çŸ¥è¯†æ‰å®ï¼Œå…·å¤‡è‰¯å¥½çš„åˆ†æå’Œè§£å†³é—®é¢˜çš„èƒ½åŠ›ã€‚';
} else if (percentageScore >= 70) {
summary = 'æ‚¨åœ¨æœ¬æ¬¡è€ƒè¯•ä¸­è¡¨ç°è‰¯å¥½ï¼ŒæŒæ¡äº†å¤§éƒ¨åˆ†çŸ¥è¯†ç‚¹ï¼Œè¿˜æœ‰è¿›ä¸€æ­¥æå‡çš„ç©ºé—´ã€‚';
} else if (percentageScore >= 60) {
summary = 'æ‚¨åœ¨æœ¬æ¬¡è€ƒè¯•ä¸­è¾¾åˆ°äº†åŸºæœ¬è¦æ±‚ï¼Œå»ºè®®ç»§ç»­åŠ å¼ºå­¦ä¹ å’Œç»ƒä¹ ã€‚';
} else {
summary = 'å»ºè®®æ‚¨ç³»ç»Ÿæ€§åœ°å¤ä¹ ç›¸å…³çŸ¥è¯†ç‚¹ï¼ŒåŠ å¼ºåŸºç¡€è®­ç»ƒï¼Œäº‰å–æ›´å¥½çš„æˆç»©ã€‚';
}

document.getElementById('overallSummary').textContent = summary;

// ç”Ÿæˆä¼˜åŠ¿å’Œå»ºè®®
this.generateStrengthsAndImprovements();
}

generateStrengthsAndImprovements() {
const questionScores = this.scores.question_scores || [];
const correctQuestions = questionScores.filter(q => q.percentage >= 80);
const incorrectQuestions = questionScores.filter(q => q.percentage < 60);

const strengthsContainer = document.getElementById('strengths');
const improvementsContainer = document.getElementById('improvements');

// ç”Ÿæˆä¼˜åŠ¿
if (correctQuestions.length > 0) {
const strengthsList = [
`æ­£ç¡®å®Œæˆäº† ${correctQuestions.length} é“é¢˜ç›®`,
'å±•ç°äº†è‰¯å¥½çš„çŸ¥è¯†åŸºç¡€',
'ç­”é¢˜æ€è·¯æ¸…æ™°å‡†ç¡®'
];
strengthsContainer.innerHTML = strengthsList.map(item => 
`<div class="flex items-center text-green-800">
<i class="ri-check-line mr-2 text-green-600"></i>
<span>${item}</span>
</div>`
).join('');
} else {
strengthsContainer.innerHTML = '<div class="text-green-800">ç»§ç»­åŠªåŠ›ï¼Œä¿æŒå­¦ä¹ çƒ­æƒ…</div>';
}

// ç”Ÿæˆæ”¹è¿›å»ºè®®
if (incorrectQuestions.length > 0) {
const improvementsList = [
`éœ€è¦åŠ å¼º ${incorrectQuestions.length} é“é¢˜ç›®ç›¸å…³çš„çŸ¥è¯†ç‚¹`,
'å»ºè®®å¤šåšç±»ä¼¼é¢˜ç›®è¿›è¡Œç»ƒä¹ ',
'å¯ä»¥å¯»æ±‚è€å¸ˆæˆ–åŒå­¦çš„å¸®åŠ©'
];
improvementsContainer.innerHTML = improvementsList.map(item => 
`<div class="flex items-center text-yellow-800">
<i class="ri-arrow-right-circle-line mr-2 text-yellow-600"></i>
<span>${item}</span>
</div>`
).join('');
} else {
improvementsContainer.innerHTML = '<div class="text-yellow-800">ç»§ç»­ä¿æŒå½“å‰çš„å­¦ä¹ çŠ¶æ€</div>';
}
}

calculateTimeSpent() {
// ç®€åŒ–å¤„ç†ï¼Œè¿”å›é»˜è®¤ç”¨æ—¶
return '45åˆ†';
}

animateProgress() {
// å»¶è¿Ÿæ‰§è¡ŒåŠ¨ç”»ä»¥è·å¾—æ›´å¥½çš„è§†è§‰æ•ˆæœ
setTimeout(() => {
const percentageScore = this.scores.percentage_score || 0;
const totalScore = this.scores.total_score || 0;
const maxScore = this.scores.max_score || 1;
const totalPercentage = (totalScore / maxScore) * 100;

document.getElementById('totalProgressFill').style.width = `${totalPercentage}%`;
document.getElementById('percentageProgressFill').style.width = `${percentageScore}%`;
}, 500);
}
}

// åˆå§‹åŒ–ç»“æœå±•ç¤º
document.addEventListener('DOMContentLoaded', function() {
new ResultsDisplay();
});
</script>
</body>
</html>
