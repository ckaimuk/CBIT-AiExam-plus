<!DOCTYPE html>
<html lang="zh-CN" id="htmlRoot">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title data-i18n="question.management.title">é¢˜åº“ç®¡ç† - IMBA æ™ºèƒ½è€ƒè¯•ç³»ç»Ÿ</title>
<link rel="icon" type="image/x-icon" id="faviconLink" href="/favicon.ico">
<script src="https://cdn.tailwindcss.com/3.4.16"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css" rel="stylesheet">
<!-- MathJax for mathematical formula rendering -->
<script>
// é…ç½® MathJax
window.MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']],
    processEscapes: true,
    processEnvironments: true
  },
  options: {
    skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  },
  startup: {
    ready: () => {
      // MathJax is loaded and ready in question management
      // MathJax å¯¹è±¡æ£€æŸ¥å®Œæˆ
      
      MathJax.startup.defaultReady();
      
      // ç­‰å¾…ä¸€å°æ®µæ—¶é—´ç¡®ä¿æ‰€æœ‰æ–¹æ³•éƒ½å¯ç”¨
      setTimeout(() => {
        // å»¶è¿Ÿæ£€æŸ¥ MathJax æ–¹æ³•å¯ç”¨æ€§
        
        // è®¾ç½®å…¨å±€æ ‡å¿—è¡¨ç¤º MathJax å·²å‡†å¤‡å°±ç»ª
        window.mathJaxReady = true;
        
        // è§¦å‘è‡ªå®šä¹‰äº‹ä»¶
        window.dispatchEvent(new CustomEvent('mathjax-ready'));
        
        // MathJax åˆå§‹åŒ–å®Œæˆ
      }, 100);
    }
  }
};
</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="/static/js/i18n.js"></script>
<script>
tailwind.config = {
theme: {
extend: {
colors: {
primary: '#2563eb',
secondary: '#3b82f6',
success: '#10b981',
warning: '#f59e0b',
danger: '#ef4444'
},
fontFamily: {
'sans': ['Inter', 'system-ui', 'sans-serif']
}
}
}
}
</script>
<style>
body {
font-family: 'Inter', sans-serif;
background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
}

.card {
background: white;
border-radius: 12px;
box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
transition: all 0.3s ease;
}

.card:hover {
box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
}

.question-card {
transition: all 0.3s ease;
border-left: 4px solid transparent;
}

.question-card:hover {
border-left-color: #2563eb;
transform: translateX(4px);
}

.filter-chip {
transition: all 0.2s ease;
}

.filter-chip:hover {
transform: translateY(-1px);
}
</style>
</head>

<body class="min-h-screen">
<!-- Navigation -->
<nav class="bg-white shadow-sm border-b sticky top-0 z-50">
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
<div class="flex justify-between items-center h-16">
<div class="flex items-center space-x-4">
<a href="/admin/dashboard" class="flex items-center space-x-3">
<img src="https://static.readdy.ai/image/3c1ff9a008dc8b425236e4faed5d7924/c0ad19844b74c75ecb76a8cc5a6f9bd3.jfif" 
alt="IMBA Logo" class="w-8 h-8 object-contain">
<span class="font-bold text-xl text-primary" data-i18n="question.management.title_short">é¢˜åº“ç®¡ç†</span>
</a>
</div>
<div class="flex items-center space-x-4">
<!-- Language Toggle -->
<button id="languageToggle" class="text-gray-600 hover:text-primary transition-colors px-3 py-2 rounded-lg border border-gray-200">
<i class="ri-global-line mr-1"></i>
<span class="language-display">ä¸­</span>
</button>
<a href="/admin/dashboard" class="text-gray-600 hover:text-primary transition-colors">
<i class="ri-dashboard-line mr-1"></i><span data-i18n="nav.admin_panel">ç®¡ç†é¢æ¿</span>
</a>
<a href="/exam_config_management.html" class="text-gray-600 hover:text-primary transition-colors">
<i class="ri-settings-3-line mr-1"></i><span data-i18n="nav.exam_config">è€ƒè¯•é…ç½®</span>
</a>
<button id="logoutBtn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm transition-colors">
<i class="ri-logout-box-line mr-1"></i><span data-i18n="nav.logout">é€€å‡ºç™»å½•</span>
</button>
</div>
</div>
</div>
</nav>

<!-- Main Content -->
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
<!-- Page Header -->
<div class="mb-8">
<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
<div>
<h1 class="text-3xl font-bold text-gray-900 mb-2" data-i18n="question.management.title_short">é¢˜åº“ç®¡ç†</h1>
<p class="text-gray-600" data-i18n="question.management.description">ç®¡ç†è€ƒè¯•é¢˜ç›®ï¼Œé…ç½®å…¨å±€é¢˜ç›®å‚æ•°</p>
</div>
                <div class="flex space-x-3 mt-4 sm:mt-0">
                    <button id="bulkActionBtn" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg flex items-center">
                        <i class="ri-checkbox-multiple-line mr-2"></i><span data-i18n="question.bulk_operations">æ‰¹é‡æ“ä½œ</span>
                        <span id="selectedCount" class="ml-1 bg-purple-400 px-2 py-1 rounded-full text-xs">0</span>
                    </button>
                    <button id="clearAllBtn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg flex items-center">
                        <i class="ri-delete-bin-2-line mr-2"></i><span data-i18n="question.clear_all">æ¸…ç©ºæ‰€æœ‰</span>
                    </button>
                    <button id="aiGenerateBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center">
                        <i class="ri-robot-line mr-2"></i><span data-i18n="question.ai_generate">AIç”Ÿæˆ</span>
                    </button>
                    <button id="addQuestionBtn" class="bg-primary hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center">
                        <i class="ri-add-line mr-2"></i><span data-i18n="question.add_question">æ·»åŠ é¢˜ç›®</span>
                    </button>
                </div>
</div>
</div>

<!-- Statistics Cards -->
<div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
<div class="card p-6">
<div class="flex items-center">
<div class="flex-shrink-0">
<div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
<i class="ri-question-line text-blue-600"></i>
</div>
</div>
<div class="ml-4">
<p class="text-sm font-medium text-gray-500" data-i18n="question.stats.total_questions">æ€»é¢˜ç›®</p>
<p class="text-2xl font-bold text-gray-900" id="totalQuestions">-</p>
</div>
</div>
</div>

<div class="card p-6">
<div class="flex items-center">
<div class="flex-shrink-0">
<div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
<i class="ri-checkbox-circle-line text-green-600"></i>
</div>
</div>
<div class="ml-4">
<p class="text-sm font-medium text-gray-500" data-i18n="question.stats.active_questions">å·²æ¿€æ´»</p>
<p class="text-2xl font-bold text-gray-900" id="activeQuestions">-</p>
</div>
</div>
</div>

<div class="card p-6">
<div class="flex items-center">
<div class="flex-shrink-0">
<div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
<i class="ri-bookmark-line text-purple-600"></i>
</div>
</div>
<div class="ml-4">
<p class="text-sm font-medium text-gray-500" data-i18n="question.stats.subject_count">å­¦ç§‘æ•°</p>
<p class="text-2xl font-bold text-gray-900" id="subjectCount">-</p>
</div>
</div>
</div>

<div class="card p-6">
<div class="flex items-center">
<div class="flex-shrink-0">
<div class="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center">
<i class="ri-star-line text-orange-600"></i>
</div>
</div>
<div class="ml-4">
<p class="text-sm font-medium text-gray-500" data-i18n="question.stats.avg_difficulty">å¹³å‡éš¾åº¦</p>
<p class="text-2xl font-bold text-gray-900" id="avgDifficulty">-</p>
</div>
</div>
</div>
</div>

<!-- Filters and Search -->
<div class="card p-6 mb-6">
<div class="flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0">
<!-- Search -->
<div class="flex-1 max-w-md">
<div class="relative">
<div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
<i class="ri-search-line text-gray-400"></i>
</div>
<input type="text" id="searchInput" placeholder="æœç´¢é¢˜ç›®å†…å®¹..." 
class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
</div>
</div>

<!-- Filters -->
<div class="flex flex-wrap gap-2">
<select id="subjectFilter" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm">
<option value="" data-i18n="question.filter.all_subjects">æ‰€æœ‰å­¦ç§‘</option>
<option value="æ•°å­¦">æ•°å­¦</option>
<option value="ç»Ÿè®¡å­¦">ç»Ÿè®¡å­¦</option>
<option value="è®¡ç®—æœºç§‘å­¦">è®¡ç®—æœºç§‘å­¦</option>
<option value="å·¥ç¨‹å­¦">å·¥ç¨‹å­¦</option>
</select>

                <select id="difficultyFilter" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm">
                    <option value="" data-i18n="question.filter.all_difficulties">æ‰€æœ‰éš¾åº¦</option>
                    
                    <!-- åŸºç¡€æ•™è‚² -->
                    <optgroup label="â”â”â” åŸºç¡€æ•™è‚² â”â”â”">
                        <option value="high_school">é«˜ä¸­æ°´å¹³</option>
                        <option value="undergraduate_basic">æœ¬ç§‘åŸºç¡€</option>
                        <option value="undergraduate_advanced">æœ¬ç§‘é«˜çº§</option>
                    </optgroup>
                    
                    <!-- å­¦æœ¯ç ”ç©¶ -->
                    <optgroup label="â”â”â” å­¦æœ¯ç ”ç©¶ â”â”â”">
                        <option value="graduate">ç ”ç©¶ç”Ÿæ°´å¹³</option>
                    </optgroup>
                </select>

<select id="typeFilter" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm">
<option value="" data-i18n="question.filter.all_types">æ‰€æœ‰é¢˜å‹</option>
<option value="multiple_choice">é€‰æ‹©é¢˜</option>
<option value="short_answer">ç®€ç­”é¢˜</option>
<option value="programming">ç¼–ç¨‹é¢˜</option>
</select>

<select id="statusFilter" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-sm">
<option value="" data-i18n="question.filter.all_status">æ‰€æœ‰çŠ¶æ€</option>
<option value="true">å·²æ¿€æ´»</option>
<option value="false">æœªæ¿€æ´»</option>
</select>
</div>
</div>
</div>

<!-- Questions List -->
<div class="card p-6">
<div class="flex items-center justify-between mb-6">
<h2 class="text-lg font-semibold text-gray-900" data-i18n="question.list.title">é¢˜ç›®åˆ—è¡¨</h2>
<div class="flex items-center space-x-2 text-sm text-gray-500">
<span data-i18n="question.list.total_count">å…±</span> <span id="totalCount">0</span> <span data-i18n="question.list.questions_unit">é¢˜</span>
<span>Â·</span>
<span data-i18n="question.list.page_number">ç¬¬</span> <span id="currentPage">1</span> <span data-i18n="question.list.page_unit">é¡µ</span>
</div>
</div>

<!-- Questions Grid -->
<div id="questionsContainer" class="space-y-4">
<!-- åŠ¨æ€åŠ è½½é¢˜ç›® -->
</div>

<!-- Pagination -->
<div class="flex items-center justify-between mt-6 pt-6 border-t">
<div class="text-sm text-gray-500">
<span data-i18n="question.pagination.showing">æ˜¾ç¤ºç¬¬</span> <span id="showingStart">1</span>-<span id="showingEnd">10</span> <span data-i18n="question.pagination.items_of">é¡¹ï¼Œå…±</span> <span id="showingTotal">0</span> <span data-i18n="question.pagination.items_total">é¡¹</span>
</div>
<div class="flex items-center space-x-2">
<button id="prevPageBtn" class="px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50" disabled>
<i class="ri-arrow-left-line"></i>
</button>
<div id="pageNumbers" class="flex space-x-1">
<!-- åŠ¨æ€ç”Ÿæˆé¡µç  -->
</div>
<button id="nextPageBtn" class="px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50">
<i class="ri-arrow-right-line"></i>
</button>
</div>
</div>
</div>
</div>

<!-- Add/Edit Question Modal -->
<div id="questionModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center p-4 hidden z-50">
<div class="bg-white rounded-2xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto">
<div class="flex justify-between items-center mb-6">
<h3 class="text-xl font-semibold text-gray-900" id="modalTitle" data-i18n="question.add_question">æ·»åŠ é¢˜ç›®</h3>
<button id="closeModalBtn" class="text-gray-400 hover:text-gray-600">
<i class="ri-close-line text-xl"></i>
</button>
</div>

<form id="questionForm" class="space-y-6">
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<!-- åŸºæœ¬ä¿¡æ¯ -->
<div class="space-y-4">
<h4 class="text-lg font-medium text-gray-900 border-b pb-2">åŸºæœ¬ä¿¡æ¯</h4>

<div>
<label class="block text-sm font-medium text-gray-700 mb-2">å­¦ç§‘ *</label>
<select id="questionSubject" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
<option value="">é€‰æ‹©å­¦ç§‘</option>
<option value="æ•°å­¦">æ•°å­¦</option>
<option value="ç»Ÿè®¡å­¦">ç»Ÿè®¡å­¦</option>
<option value="è®¡ç®—æœºç§‘å­¦">è®¡ç®—æœºç§‘å­¦</option>
<option value="å·¥ç¨‹å­¦">å·¥ç¨‹å­¦</option>
</select>
</div>

<div>
<label class="block text-sm font-medium text-gray-700 mb-2">å­æ ‡ç­¾</label>
<input type="text" id="questionSubTag" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="å¦‚ï¼šå¾®ç§¯åˆ†ã€è¯­æ³•ç­‰">
</div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">éš¾åº¦ *</label>
                    <select id="questionDifficulty" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                        <option value="">é€‰æ‹©éš¾åº¦</option>
                        
                        <!-- åŸºç¡€æ•™è‚² -->
                        <optgroup label="â”â”â” åŸºç¡€æ•™è‚² â”â”â”">
                            <option value="high_school">é«˜ä¸­æ°´å¹³</option>
                            <option value="undergraduate_basic">æœ¬ç§‘åŸºç¡€</option>
                            <option value="undergraduate_advanced">æœ¬ç§‘é«˜çº§</option>
                        </optgroup>
                        
                        <!-- å­¦æœ¯ç ”ç©¶ -->
                        <optgroup label="â”â”â” å­¦æœ¯ç ”ç©¶ â”â”â”">
                            <option value="graduate">ç ”ç©¶ç”Ÿæ°´å¹³</option>
                        </optgroup>
                    </select>
                </div>

<div>
<label class="block text-sm font-medium text-gray-700 mb-2">è®¤çŸ¥å±‚æ¬¡</label>
<select id="questionCognitive" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
<option value="ç†è§£">ç†è§£</option>
<option value="åº”ç”¨">åº”ç”¨</option>
<option value="åˆ†æ">åˆ†æ</option>
<option value="ç»¼åˆ">ç»¼åˆ</option>
<option value="è¯„ä»·">è¯„ä»·</option>
</select>
</div>

<div>
<label class="block text-sm font-medium text-gray-700 mb-2">é¢˜å‹ *</label>
<select id="questionType" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
<option value="">é€‰æ‹©é¢˜å‹</option>
<option value="multiple_choice">é€‰æ‹©é¢˜</option>
<option value="short_answer">ç®€ç­”é¢˜</option>
<option value="programming">ç¼–ç¨‹é¢˜</option>
</select>
</div>

<div>
<label class="block text-sm font-medium text-gray-700 mb-2">åˆ†å€¼</label>
<input type="number" id="questionPoints" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" value="1" min="1" max="10">
</div>

<div>
<label class="flex items-center">
<input type="checkbox" id="questionActive" class="rounded text-primary" checked>
<span class="ml-2 text-sm text-gray-700">æ¿€æ´»çŠ¶æ€</span>
</label>
</div>
</div>

<!-- é¢˜ç›®å†…å®¹ -->
<div class="space-y-4">
<h4 class="text-lg font-medium text-gray-900 border-b pb-2">é¢˜ç›®å†…å®¹</h4>

<div>
<label class="block text-sm font-medium text-gray-700 mb-2">é¢˜ç›®å†…å®¹ *</label>
<textarea id="questionContent" required rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="è¾“å…¥é¢˜ç›®å†…å®¹..."></textarea>
</div>

<!-- é€‰æ‹©é¢˜é€‰é¡¹ -->
<div id="optionsContainer" class="hidden">
<label class="block text-sm font-medium text-gray-700 mb-2">é€‰é¡¹</label>
<div class="space-y-2" id="optionsList">
<div class="flex items-center space-x-2">
<span class="w-6 text-center font-medium">A</span>
<input type="text" class="option-input flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="é€‰é¡¹A">
</div>
<div class="flex items-center space-x-2">
<span class="w-6 text-center font-medium">B</span>
<input type="text" class="option-input flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="é€‰é¡¹B">
</div>
<div class="flex items-center space-x-2">
<span class="w-6 text-center font-medium">C</span>
<input type="text" class="option-input flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="é€‰é¡¹C">
</div>
<div class="flex items-center space-x-2">
<span class="w-6 text-center font-medium">D</span>
<input type="text" class="option-input flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="é€‰é¡¹D">
</div>
</div>
</div>

<div>
<label class="block text-sm font-medium text-gray-700 mb-2">æ­£ç¡®ç­”æ¡ˆ *</label>
<textarea id="questionAnswer" required rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="è¾“å…¥æ­£ç¡®ç­”æ¡ˆ..."></textarea>
</div>

<div>
<label class="block text-sm font-medium text-gray-700 mb-2">è§£æ</label>
<textarea id="questionExplanation" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="è¾“å…¥é¢˜ç›®è§£æ..."></textarea>
</div>
</div>
</div>

<div class="flex justify-end space-x-3 pt-6 border-t">
<button type="button" id="cancelBtn" class="px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
å–æ¶ˆ
</button>
<button type="submit" id="saveBtn" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-blue-700 transition-colors">
<span id="saveText">ä¿å­˜é¢˜ç›®</span>
</button>
</div>
</form>
</div>
</div>

<!-- AI Generate Modal -->
<div id="aiGenerateModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center p-4 hidden z-50">
<div class="bg-white rounded-2xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto">
<div class="flex justify-between items-center mb-6">
<h3 class="text-xl font-semibold text-gray-900 flex items-center">
<i class="ri-robot-line text-blue-600 mr-2"></i>
<span data-i18n="ai_generate.title">æ™ºèƒ½AIç”Ÿé¢˜åŠ©æ‰‹</span>
</h3>
<button id="closeAIModalBtn" class="text-gray-400 hover:text-gray-600">
<i class="ri-close-line text-xl"></i>
</button>
</div>

<form id="aiGenerateForm" class="space-y-6">
<!-- åŸºç¡€è®¾ç½® -->
<div class="bg-gray-50 rounded-lg p-4">
<h4 class="text-lg font-medium text-gray-900 mb-4 flex items-center">
<i class="ri-settings-3-line text-blue-600 mr-2"></i>
<span data-i18n="ai_generate.basic_settings">åŸºç¡€è®¾ç½®</span>
</h4>
<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
<div>
<label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="ai_generate.question_count">é¢˜ç›®æ•°é‡</label>
<input type="number" id="aiQuestionCount" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" value="5" min="1" max="20">
</div>

<div>
<label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="ai_generate.question_language">é¢˜ç›®è¯­è¨€</label>
<select id="aiLanguage" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
<option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
<option value="en">ğŸ‡ºğŸ‡¸ English</option>
</select>
</div>

<div>
<label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="ai_generate.points_per_question">æ¯é¢˜åˆ†å€¼</label>
<input type="number" id="aiPointsPerQuestion" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" value="1" min="1" max="10">
</div>
</div>
</div>

<!-- å­¦ç§‘ä¸é¢†åŸŸ -->
<div class="bg-blue-50 rounded-lg p-4">
<h4 class="text-lg font-medium text-gray-900 mb-4 flex items-center">
<i class="ri-book-line text-blue-600 mr-2"></i>
<span data-i18n="ai_generate.subject_and_domain">å­¦ç§‘ä¸é¢†åŸŸ</span>
</h4>
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
<div>
<label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="ai_generate.main_subject">ä¸»è¦å­¦ç§‘</label>
<select id="aiSubject" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
<option value="æ•°å­¦" data-en="Mathematics">ğŸ“ æ•°å­¦ (Mathematics)</option>
<option value="ç‰©ç†" data-en="Physics">âš›ï¸ ç‰©ç† (Physics)</option>
<option value="ç»Ÿè®¡å­¦" data-en="Statistics">ğŸ“Š ç»Ÿè®¡å­¦ (Statistics)</option>
<option value="è®¡ç®—æœºç§‘å­¦" data-en="Computer Science">ğŸ’» è®¡ç®—æœºç§‘å­¦ (Computer Science)</option>
<option value="å·¥ç¨‹" data-en="Engineering">âš™ï¸ å·¥ç¨‹ (Engineering)</option>
</select>
</div>

<div>
<label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="ai_generate.sub_domain">å­é¢†åŸŸ (å¯é€‰)</label>
<select id="aiSubDomain" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
<option value="" data-i18n="ai_generate.select_subject_first">è¯·å…ˆé€‰æ‹©ä¸»è¦å­¦ç§‘</option>
</select>
</div>
</div>
</div>

<!-- éš¾åº¦ä¸é¢˜å‹ -->
<div class="bg-green-50 rounded-lg p-4">
<h4 class="text-lg font-medium text-gray-900 mb-4 flex items-center">
<i class="ri-bar-chart-line text-green-600 mr-2"></i>
<span data-i18n="ai_generate.difficulty_and_type">éš¾åº¦ä¸é¢˜å‹</span>
</h4>
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
<div>
<label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="ai_generate.difficulty_level">éš¾åº¦ç­‰çº§</label>
<select id="aiDifficulty" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
<!-- åŸºç¡€éš¾åº¦ -->
<optgroup data-i18n="ai_generate.basic_education" label="â”â”â” åŸºç¡€æ•™è‚² â”â”â”">
<option value="high_school" data-i18n="ai_generate.high_school">ğŸ“ é«˜ä¸­æ°´å¹³</option>
<option value="undergraduate_basic" data-i18n="ai_generate.undergraduate_basic" selected>ğŸ“š æœ¬ç§‘åŸºç¡€</option>
<option value="undergraduate_advanced" data-i18n="ai_generate.undergraduate_advanced">ğŸ¯ æœ¬ç§‘é«˜çº§</option>
</optgroup>

<!-- æ ‡å‡†åŒ–è€ƒè¯• -->
<optgroup data-i18n="ai_generate.standardized_tests" label="â”â”â” æ ‡å‡†åŒ–è€ƒè¯• â”â”â”">
<option value="gre_level" data-i18n="ai_generate.gre_level">ğŸ¯ GREéš¾åº¦</option>
</optgroup>

<!-- å­¦æœ¯ç ”ç©¶ -->
<optgroup data-i18n="ai_generate.academic_research" label="â”â”â” å­¦æœ¯ç ”ç©¶ â”â”â”">
<option value="graduate_study" data-i18n="ai_generate.graduate_study">ğŸ›ï¸ ç ”ç©¶ç”Ÿæ°´å¹³</option>
<option value="doctoral_research" data-i18n="ai_generate.doctoral_research">ğŸ”¬ åšå£«ç ”ç©¶</option>
</optgroup>
</select>
</div>

<div>
<label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="ai_generate.question_type">é¢˜ç›®ç±»å‹</label>
<select id="aiQuestionType" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
<option value="multiple_choice" data-i18n="ai_generate.multiple_choice">ğŸ“ é€‰æ‹©é¢˜</option>
<option value="short_answer" data-i18n="ai_generate.short_answer">ğŸ“„ ç®€ç­”é¢˜</option>
<option value="programming" data-i18n="ai_generate.programming">ğŸ’» ç¼–ç¨‹é¢˜</option>
<option value="true_false" data-i18n="ai_generate.true_false">âœ… åˆ¤æ–­é¢˜</option>
<option value="fill_blank" data-i18n="ai_generate.fill_blank">ğŸ“ å¡«ç©ºé¢˜</option>
<option value="essay" data-i18n="ai_generate.essay">ğŸ“– è®ºè¿°é¢˜</option>
</select>
</div>
</div>
</div>

<!-- åœºæ™¯è®¾ç½® -->
<div class="bg-purple-50 rounded-lg p-4">
<h4 class="text-lg font-medium text-gray-900 mb-4 flex items-center">
<i class="ri-landscape-line text-purple-600 mr-2"></i>
<span data-i18n="ai_generate.scenario_settings">åœºæ™¯è®¾ç½®</span>
</h4>
<div class="space-y-4">
<div class="flex items-center space-x-3">
<input type="checkbox" id="aiUseScenarios" class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
<label for="aiUseScenarios" class="text-sm text-gray-700" data-i18n="ai_generate.use_real_scenarios">ä½¿ç”¨çœŸå®åº”ç”¨åœºæ™¯é¢˜ç›®</label>
<span class="text-xs text-gray-500" data-i18n="ai_generate.rich_background">ï¼ˆæä¾›ä¸°å¯Œçš„èƒŒæ™¯ç¯å¢ƒæè¿°ï¼‰</span>
</div>

<div id="scenarioExamples" class="hidden mt-3">
<p class="text-sm text-gray-600 mb-2" data-i18n="ai_generate.scenario_examples">åœºæ™¯ç±»å‹ç¤ºä¾‹ï¼š</p>
<div class="flex flex-wrap gap-2">
<span class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs" data-i18n="ai_generate.engineering_project">ğŸ­ å·¥ç¨‹é¡¹ç›®</span>
<span class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs" data-i18n="ai_generate.scientific_research">ğŸ”¬ ç§‘å­¦ç ”ç©¶</span>
<span class="px-2 py-1 bg-yellow-100 text-yellow-700 rounded text-xs" data-i18n="ai_generate.business_decision">ğŸ’¼ å•†ä¸šå†³ç­–</span>
<span class="px-2 py-1 bg-red-100 text-red-700 rounded text-xs" data-i18n="ai_generate.laboratory_environment">ğŸ¯ å®éªŒå®¤ç¯å¢ƒ</span>
</div>
</div>
</div>
</div>

<div>
<label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="ai_generate.custom_prompt">è‡ªå®šä¹‰æç¤ºè¯ï¼ˆå¯é€‰ï¼‰</label>

<textarea id="aiCustomPrompt" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" data-i18n-placeholder="ai_generate.custom_prompt_placeholder" placeholder="è¾“å…¥é¢å¤–çš„é¢˜ç›®è¦æ±‚..."></textarea>
</div>

<div class="flex justify-end space-x-3 pt-4">
<button type="button" id="cancelAIBtn" class="px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors" data-i18n="common.cancel">
å–æ¶ˆ
</button>
<button type="submit" id="generateBtn" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center">
<i class="ri-robot-line mr-2"></i>
<span id="generateText" data-i18n="ai_generate.generate_questions">ç”Ÿæˆé¢˜ç›®</span>
</button>
</div>
</form>
</div>
</div>

<!-- Bulk Actions Modal -->
<div id="bulkModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center p-4 hidden z-50">
<div class="bg-white rounded-2xl p-6 w-full max-w-md">
<div class="flex justify-between items-center mb-6">
<h3 class="text-xl font-semibold text-gray-900" data-i18n="question.bulk_operations">æ‰¹é‡æ“ä½œ</h3>
<button id="closeBulkModalBtn" class="text-gray-400 hover:text-gray-600">
<i class="ri-close-line text-xl"></i>
</button>
</div>

<div class="space-y-4">
<p class="text-sm text-gray-600">å·²é€‰æ‹© <span id="selectedCount">0</span> ä¸ªé¢˜ç›®</p>

<div class="space-y-2">
<button id="bulkActivateBtn" class="w-full text-left px-4 py-3 border border-gray-300 rounded-lg hover:bg-green-50 hover:border-green-300 transition-colors">
<i class="ri-checkbox-circle-line text-green-600 mr-2"></i>
æ‰¹é‡æ¿€æ´»
</button>

<button id="bulkDeactivateBtn" class="w-full text-left px-4 py-3 border border-gray-300 rounded-lg hover:bg-yellow-50 hover:border-yellow-300 transition-colors">
<i class="ri-close-circle-line text-yellow-600 mr-2"></i>
æ‰¹é‡ç¦ç”¨
</button>

                        <button id="bulkDeleteBtn" class="w-full text-left px-4 py-3 border border-gray-300 rounded-lg hover:bg-red-50 hover:border-red-300 transition-colors">
                            <i class="ri-delete-bin-line text-red-600 mr-2"></i>
<span data-i18n="question.bulk_delete">æ‰¹é‡åˆ é™¤</span>
                        </button>
</div>

<div class="flex justify-end space-x-3 pt-4 border-t">
<button id="cancelBulkBtn" class="px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
å–æ¶ˆ
</button>
</div>
</div>
</div>
</div>

<script>
// å…¨å±€å˜é‡
let currentPage = 1;
let totalPages = 1;
let currentQuestions = [];
let selectedQuestions = new Set();
let editingQuestionId = null;

// é¡µé¢åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', async function() {
// é¡µé¢åˆå§‹åŒ–å¼€å§‹

// ç­‰å¾…å¤šè¯­è¨€åˆå§‹åŒ–å®Œæˆ
if (window.i18n && !window.i18n.initialized) {
await new Promise(resolve => {
document.addEventListener('i18n:initialized', resolve, { once: true });
});
}

// å…ˆåˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨ï¼ˆåŒ…æ‹¬è¯­è¨€åˆ‡æ¢æŒ‰é’®ï¼‰
initEventListeners();

// ç„¶åæ£€æŸ¥ç®¡ç†å‘˜çŠ¶æ€
try {
const statusResponse = await fetch('/api/admin/status');
const statusResult = await statusResponse.json();

if (statusResult.is_admin) {
loadQuestions();
loadStatistics();
} else {
console.log('âŒ ç®¡ç†å‘˜æœªç™»å½•ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µ');
alert('è¯·å…ˆç™»å½•ç®¡ç†å‘˜è´¦æˆ·');
window.location.href = '/admin/login';
return;
}
} catch (error) {
console.error('æ£€æŸ¥ç®¡ç†å‘˜çŠ¶æ€å¤±è´¥:', error);
// å°è¯•åŠ è½½æ•°æ®ï¼Œå¦‚æœå¤±è´¥ä¼šæ˜¾ç¤ºç›¸åº”é”™è¯¯
loadQuestions();
loadStatistics();
}

// é¢å¤–çš„ MathJax æ¸²æŸ“è§¦å‘å™¨
setTimeout(() => {
    if (typeof renderMathJaxForQuestions === 'function') {
        renderMathJaxForQuestions();
    }
}, 1000);

// ç›‘å¬ MathJax å°±ç»ªäº‹ä»¶
window.addEventListener('mathjax-ready', () => {
    setTimeout(() => {
        if (typeof renderMathJaxForQuestions === 'function') {
            renderMathJaxForQuestions();
        }
    }, 200);
});

// å¦‚æœ MathJax å·²ç»å°±ç»ªï¼Œç«‹å³è§¦å‘
if (window.mathJaxReady) {
    setTimeout(() => {
        if (typeof renderMathJaxForQuestions === 'function') {
            renderMathJaxForQuestions();
        }
    }, 200);
}

// é¡µé¢åˆå§‹åŒ–å®Œæˆ
});

// åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
function initEventListeners() {
// è¯­è¨€åˆ‡æ¢æŒ‰é’®ç”± i18n.js è‡ªåŠ¨å¤„ç†ï¼Œæ— éœ€æ‰‹åŠ¨ç»‘å®š

// å¤šè¯­è¨€å˜åŒ–äº‹ä»¶ç›‘å¬
        document.addEventListener('i18n:languageChanged', () => {
            console.log('Language changed in question management page');
            // è¯­è¨€åˆ‡æ¢æŒ‰é’®çš„æ–‡æœ¬æ›´æ–°ç°åœ¨ç”± i18n.js è‡ªåŠ¨å¤„ç†
            // é‡æ–°åŠ è½½é¢˜ç›®åˆ—è¡¨ä»¥åº”ç”¨æ–°è¯­è¨€
            loadQuestions();
        });

// æœç´¢å’Œç­›é€‰
document.getElementById('searchInput').addEventListener('input', debounce(loadQuestions, 300));
document.getElementById('subjectFilter').addEventListener('change', loadQuestions);
document.getElementById('difficultyFilter').addEventListener('change', loadQuestions);
document.getElementById('typeFilter').addEventListener('change', loadQuestions);
document.getElementById('statusFilter').addEventListener('change', loadQuestions);

// åˆ†é¡µ
document.getElementById('prevPageBtn').addEventListener('click', () => changePage(currentPage - 1));
document.getElementById('nextPageBtn').addEventListener('click', () => changePage(currentPage + 1));

// æ¨¡æ€æ¡†
document.getElementById('addQuestionBtn').addEventListener('click', showAddQuestionModal);
document.getElementById('closeModalBtn').addEventListener('click', hideQuestionModal);
document.getElementById('cancelBtn').addEventListener('click', hideQuestionModal);
document.getElementById('questionForm').addEventListener('submit', handleSaveQuestion);

// AIç”Ÿæˆ
document.getElementById('aiGenerateBtn').addEventListener('click', showAIGenerateModal);
document.getElementById('closeAIModalBtn').addEventListener('click', hideAIGenerateModal);
document.getElementById('cancelAIBtn').addEventListener('click', hideAIGenerateModal);
document.getElementById('aiGenerateForm').addEventListener('submit', handleAIGenerate);

// é¢„è®¾æ ‡ç­¾ç‚¹å‡»äº‹ä»¶
document.addEventListener('click', function(e) {
    if (e.target.classList.contains('preset-tag-btn')) {
        const prompt = e.target.getAttribute('data-prompt');
        const textarea = document.getElementById('aiCustomPrompt');
        
        // å¦‚æœæ˜¯ä¸“ä¸šçº§åˆ«æŒ‰é’®ï¼ŒåŒæ—¶è®¾ç½®éš¾åº¦
        if (e.target.classList.contains('preset-difficulty-btn')) {
            const difficulty = e.target.getAttribute('data-difficulty');
            const difficultySelect = document.getElementById('aiDifficulty');
            if (difficulty && difficultySelect) {
                difficultySelect.value = difficulty;
                
                // æ·»åŠ é—ªçƒæ•ˆæœæç¤ºç”¨æˆ·éš¾åº¦å·²æ›´æ”¹
                difficultySelect.style.backgroundColor = '#e0f2fe';
                setTimeout(() => {
                    difficultySelect.style.backgroundColor = '';
                }, 1000);
            }
        }
        
        // è®¾ç½®æç¤ºè¯
        if (!textarea.value.trim()) {
            textarea.value = prompt;
        } else {
            textarea.value += '\n\n' + prompt;
        }
        
        // æ·»åŠ è§†è§‰åé¦ˆ
        e.target.style.transform = 'scale(0.95)';
        setTimeout(() => {
            e.target.style.transform = 'scale(1)';
        }, 150);
        
        // èšç„¦åˆ°æ–‡æœ¬æ¡†
        textarea.focus();
    }
});

// æ‰¹é‡æ“ä½œ
document.getElementById('bulkActionBtn').addEventListener('click', showBulkModal);
document.getElementById('closeBulkModalBtn').addEventListener('click', hideBulkModal);
document.getElementById('cancelBulkBtn').addEventListener('click', hideBulkModal);
document.getElementById('bulkActivateBtn').addEventListener('click', () => handleBulkAction('activate'));
document.getElementById('bulkDeactivateBtn').addEventListener('click', () => handleBulkAction('deactivate'));
document.getElementById('bulkDeleteBtn').addEventListener('click', () => handleBulkAction('delete'));
// ç§»é™¤æ‰¹é‡æ“ä½œä¸­çš„æ¸…ç©ºåŠŸèƒ½ï¼Œå•ç‹¬ç»‘å®šæ¸…ç©ºæŒ‰é’®
document.getElementById('clearAllBtn').addEventListener('click', handleClearAll);

// é¢˜ç›®è¯¦æƒ…æ¨¡æ€æ¡†
document.getElementById('closeDetailModalBtn').addEventListener('click', hideQuestionDetailModal);
document.getElementById('closeDetailBtn').addEventListener('click', hideQuestionDetailModal);

// é¢˜å‹å˜åŒ–æ—¶æ˜¾ç¤º/éšè—é€‰é¡¹
document.getElementById('questionType').addEventListener('change', function() {
const optionsContainer = document.getElementById('optionsContainer');
if (this.value === 'multiple_choice') {
optionsContainer.classList.remove('hidden');
} else {
optionsContainer.classList.add('hidden');
}
});

// ç™»å‡º
document.getElementById('logoutBtn').addEventListener('click', handleLogout);
}

// åŠ è½½é¢˜ç›®åˆ—è¡¨
async function loadQuestions() {
try {
showLoading(true);

// å®‰å…¨è·å–ç­›é€‰å‚æ•°
const searchInput = document.getElementById('searchInput');
const subjectFilter = document.getElementById('subjectFilter');
const difficultyFilter = document.getElementById('difficultyFilter');
const typeFilter = document.getElementById('typeFilter');
const statusFilter = document.getElementById('statusFilter');

const params = new URLSearchParams({
page: currentPage,
per_page: 10
});

// åªæ·»åŠ éç©ºçš„ç­›é€‰å‚æ•°
if (searchInput && searchInput.value) {
    params.append('search', searchInput.value);
}
if (subjectFilter && subjectFilter.value) {
    params.append('subject', subjectFilter.value);
}
if (difficultyFilter && difficultyFilter.value) {
    params.append('difficulty', difficultyFilter.value);
}
if (typeFilter && typeFilter.value) {
    params.append('type', typeFilter.value);
}
if (statusFilter && statusFilter.value) {
    params.append('is_active', statusFilter.value);
}

const fullUrl = `/api/questions?${params.toString()}`;
const response = await fetch(fullUrl);
const result = await response.json();

if (result.success) {
currentQuestions = result.questions;
updateQuestionsList(result.questions);
updatePagination(result.pagination);
} else {
console.error('âŒ APIè¿”å›å¤±è´¥:', result.message);
if (result.message && result.message.includes('ç®¡ç†å‘˜æƒé™')) {
showError('éœ€è¦ç®¡ç†å‘˜æƒé™è®¿é—®ï¼Œæ­£åœ¨é‡å®šå‘...');
setTimeout(() => {
window.location.href = '/';
}, 2000);
} else {
showError('åŠ è½½é¢˜ç›®å¤±è´¥: ' + result.message);
}
}
} catch (error) {
console.error('åŠ è½½é¢˜ç›®å¤±è´¥:', error);
showError('åŠ è½½é¢˜ç›®å¤±è´¥ï¼Œè¯·é‡è¯•');
} finally {
showLoading(false);
}
}

// æ›´æ–°é¢˜ç›®åˆ—è¡¨
function updateQuestionsList(questions) {
const container = document.getElementById('questionsContainer');

if (!container) {
console.error('âŒ æ‰¾ä¸åˆ°questionsContainerå…ƒç´ ï¼');
return;
}

if (!questions) {
console.error('âŒ é¢˜ç›®æ•°æ®ä¸ºç©ºï¼');
container.innerHTML = '<div class="text-center py-12 text-red-500">é¢˜ç›®æ•°æ®ä¸ºç©º</div>';
return;
}

if (questions.length === 0) {
container.innerHTML = `
<div class="text-center py-12">
<i class="ri-inbox-line text-4xl text-gray-400 mb-4"></i>
<p class="text-gray-500" data-i18n="question.no_questions">æš‚æ— é¢˜ç›®æ•°æ®</p>
</div>
`;
return;
}

try {
// å®Œæ•´æ¸²æŸ“é¢˜ç›®åˆ—è¡¨ï¼ˆåŒ…å«å¤é€‰æ¡†å’Œæ“ä½œæŒ‰é’®ï¼‰
container.innerHTML = questions.map((question, index) => {
return `
<div class="question-card bg-white border border-gray-200 rounded-lg p-4 mb-4 shadow-sm hover:shadow-md transition-all">
    <div class="flex items-start justify-between">
        <div class="flex-1">
            <div class="flex items-center space-x-2 mb-2">
                <input type="checkbox" class="question-checkbox rounded text-primary" value="${question.id}" 
                       ${selectedQuestions.has(parseInt(question.id)) ? 'checked' : ''}>
                <span class="px-2 py-1 text-xs font-medium rounded-full ${getSubjectColor(question.subject)} text-white">
                    ${getSubjectName(question.subject)}
                </span>
                <span class="px-2 py-1 text-xs rounded-full ${getDifficultyColor(question.difficulty)}">
                    ${getDifficultyName(question.difficulty)}
                </span>
                <span class="px-2 py-1 text-xs rounded-full ${getTypeColor(question.type)}">
                    ${getTypeName(question.type)}
                </span>
                <span class="px-2 py-1 text-xs rounded-full ${question.is_active ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">
                    ${question.is_active ? 
                        (window.i18n && window.i18n.initialized ? window.i18n.translate('question.status.active', 'å·²æ¿€æ´»') : 'å·²æ¿€æ´»') : 
                        (window.i18n && window.i18n.initialized ? window.i18n.translate('question.status.inactive', 'æœªæ¿€æ´»') : 'æœªæ¿€æ´»')
                    }
                </span>
            </div>
            <h3 class="font-medium text-gray-900 mb-2 math-content">${question.content || 'é¢˜ç›®å†…å®¹ç¼ºå¤±'}</h3>
            <div class="flex items-center text-sm text-gray-500 space-x-4">
                <span><i class="ri-star-line mr-1"></i>${question.points || 1}åˆ†</span>
                <span><i class="ri-time-line mr-1"></i>${formatDate(question.created_at || question.updated_at)}</span>
                ${question.sub_tag ? `<span><i class="ri-bookmark-line mr-1"></i>${question.sub_tag}</span>` : ''}
            </div>
        </div>
        <div class="flex items-center space-x-2 ml-4">
            <button class="detail-btn p-2 text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors" data-id="${question.id}" title="æŸ¥çœ‹è¯¦æƒ…">
                <i class="ri-eye-line"></i>
            </button>
            <button class="edit-btn p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors" data-id="${question.id}" title="ç¼–è¾‘">
                <i class="ri-edit-line"></i>
            </button>
            <button class="toggle-btn p-2 ${question.is_active ? 'text-yellow-600 hover:bg-yellow-50' : 'text-green-600 hover:bg-green-50'} rounded-lg transition-colors" data-id="${question.id}" data-active="${question.is_active}" title="${question.is_active ? 'ç¦ç”¨' : 'å¯ç”¨'}">
                <i class="${question.is_active ? 'ri-pause-circle-line' : 'ri-play-circle-line'}"></i>
            </button>
            <button class="delete-btn p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors" data-id="${question.id}" title="åˆ é™¤">
                <i class="ri-delete-bin-line"></i>
            </button>
        </div>
    </div>
</div>
`;
}).join('');

// é‡æ–°æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
addQuestionEventListeners();

// æ¸²æŸ“æ•°å­¦å…¬å¼
renderMathJaxForQuestions();

} catch (error) {
console.error('âŒ æ¸²æŸ“é¢˜ç›®åˆ—è¡¨æ—¶å‡ºé”™:', error);
container.innerHTML = `<div class="text-center py-12 text-red-500">
<p>æ¸²æŸ“å‡ºé”™: ${error.message}</p>
</div>`;
}
}

// æ·»åŠ é¢˜ç›®äº‹ä»¶ç›‘å¬å™¨
function addQuestionEventListeners() {
// æŸ¥çœ‹è¯¦æƒ…æŒ‰é’®
document.querySelectorAll('.detail-btn').forEach(btn => {
btn.addEventListener('click', (e) => {
const questionId = parseInt(e.currentTarget.dataset.id);
showQuestionDetail(questionId);
});
});

// ç¼–è¾‘æŒ‰é’®
document.querySelectorAll('.edit-btn').forEach(btn => {
btn.addEventListener('click', (e) => {
const questionId = parseInt(e.currentTarget.dataset.id);
showEditQuestionModal(questionId);
});
});

// åˆ‡æ¢çŠ¶æ€æŒ‰é’®
document.querySelectorAll('.toggle-btn').forEach(btn => {
btn.addEventListener('click', (e) => {
const questionId = parseInt(e.currentTarget.dataset.id);
const isActive = e.currentTarget.dataset.active === 'true';
toggleQuestionStatus(questionId, !isActive);
});
});

// åˆ é™¤æŒ‰é’®
document.querySelectorAll('.delete-btn').forEach(btn => {
btn.addEventListener('click', (e) => {
const questionId = parseInt(e.currentTarget.dataset.id);
deleteQuestion(questionId);
});
});

// å¤šé€‰æ¡†
document.querySelectorAll('.question-checkbox').forEach(checkbox => {
checkbox.addEventListener('change', (e) => {
const questionId = parseInt(e.target.value);
if (e.target.checked) {
selectedQuestions.add(questionId);
} else {
selectedQuestions.delete(questionId);
}
updateSelectedCount();
});
});
}

// æ›´æ–°åˆ†é¡µ
function updatePagination(pagination) {
currentPage = pagination.page;
totalPages = pagination.pages;

// æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
document.getElementById('totalCount').textContent = pagination.total;
document.getElementById('currentPage').textContent = pagination.page;
document.getElementById('showingStart').textContent = (pagination.page - 1) * pagination.per_page + 1;
document.getElementById('showingEnd').textContent = Math.min(pagination.page * pagination.per_page, pagination.total);
document.getElementById('showingTotal').textContent = pagination.total;

// æ›´æ–°æŒ‰é’®çŠ¶æ€
document.getElementById('prevPageBtn').disabled = !pagination.has_prev;
document.getElementById('nextPageBtn').disabled = !pagination.has_next;

// ç”Ÿæˆé¡µç 
generatePageNumbers();
}

// ç”Ÿæˆé¡µç 
function generatePageNumbers() {
const container = document.getElementById('pageNumbers');
const maxVisible = 5;
const start = Math.max(1, currentPage - Math.floor(maxVisible / 2));
const end = Math.min(totalPages, start + maxVisible - 1);

container.innerHTML = '';
for (let i = start; i <= end; i++) {
const button = document.createElement('button');
button.className = `px-3 py-2 text-sm rounded-lg ${i === currentPage ? 'bg-primary text-white' : 'border border-gray-300 hover:bg-gray-50'}`;
button.textContent = i;
button.addEventListener('click', () => changePage(i));
container.appendChild(button);
}
}

// åˆ‡æ¢é¡µé¢
function changePage(page) {
if (page >= 1 && page <= totalPages && page !== currentPage) {
currentPage = page;
loadQuestions();
}
}

// åŠ è½½ç»Ÿè®¡æ•°æ®
async function loadStatistics() {
try {
const response = await fetch('/api/questions?per_page=1000'); // è·å–æ‰€æœ‰é¢˜ç›®è¿›è¡Œç»Ÿè®¡
const result = await response.json();

if (result.success) {
const questions = result.questions;
const total = questions.length;
const active = questions.filter(q => q.is_active).length;
const subjects = [...new Set(questions.map(q => q.subject))].length;

// è®¡ç®—å¹³å‡éš¾åº¦ - æ”¯æŒä¸“ä¸šçº§åˆ«
const difficultyMap = { 
    'ç®€å•': 1, 'ä¸­ç­‰': 2, 'å›°éš¾': 3,
    // æ ‡å‡†åŒ–è€ƒè¯•çº§åˆ«
    'gre_math': 4, 'gmat_math': 5, 'sat_math_2': 4,
    // å­¦æœ¯ç ”ç©¶çº§åˆ«
    'advanced_undergraduate': 6, 'graduate_study': 8, 'competition_math': 7,
    // ä¸“ä¸šåº”ç”¨çº§åˆ«
    'engineering_applications': 6, 'data_science': 5, 'financial_modeling': 6
};

const avgDiff = questions.length > 0 ? 
    questions.reduce((sum, q) => sum + (difficultyMap[q.difficulty] || 2), 0) / questions.length : 0;

// è·å–ç¿»è¯‘åçš„éš¾åº¦æ–‡æœ¬
let avgDiffText;
if (avgDiff < 1.5) {
    avgDiffText = window.i18n && window.i18n.initialized ? window.i18n.translate('difficulty.easy', 'ç®€å•') : 'ç®€å•';
} else if (avgDiff < 2.5) {
    avgDiffText = window.i18n && window.i18n.initialized ? window.i18n.translate('difficulty.medium', 'ä¸­ç­‰') : 'ä¸­ç­‰';
} else if (avgDiff < 3.5) {
    avgDiffText = window.i18n && window.i18n.initialized ? window.i18n.translate('difficulty.hard', 'å›°éš¾') : 'å›°éš¾';
} else if (avgDiff < 5.5) {
    avgDiffText = window.i18n && window.i18n.initialized ? window.i18n.translate('difficulty.professional', 'ä¸“ä¸šçº§') : 'ä¸“ä¸šçº§';
} else {
    avgDiffText = window.i18n && window.i18n.initialized ? window.i18n.translate('difficulty.expert', 'ä¸“å®¶çº§') : 'ä¸“å®¶çº§';
}

document.getElementById('totalQuestions').textContent = total;
document.getElementById('activeQuestions').textContent = active;
document.getElementById('subjectCount').textContent = subjects;
document.getElementById('avgDifficulty').textContent = avgDiffText;
}
} catch (error) {
console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
}
}

// æ˜¾ç¤ºæ·»åŠ é¢˜ç›®æ¨¡æ€æ¡†
function showAddQuestionModal() {
editingQuestionId = null;
document.getElementById('modalTitle').textContent = window.i18n ? window.i18n.translate('question.add_question', 'æ·»åŠ é¢˜ç›®') : 'æ·»åŠ é¢˜ç›®';
document.getElementById('saveText').textContent = window.i18n ? window.i18n.translate('question.save_question', 'ä¿å­˜é¢˜ç›®') : 'ä¿å­˜é¢˜ç›®';
document.getElementById('questionForm').reset();
document.getElementById('questionActive').checked = true;
document.getElementById('optionsContainer').classList.add('hidden');
document.getElementById('questionModal').classList.remove('hidden');
}

// æ˜¾ç¤ºç¼–è¾‘é¢˜ç›®æ¨¡æ€æ¡†
function showEditQuestionModal(questionId) {
const question = currentQuestions.find(q => q.id === questionId);
if (!question) return;

editingQuestionId = questionId;
document.getElementById('modalTitle').textContent = window.i18n ? window.i18n.translate('question.edit_question', 'ç¼–è¾‘é¢˜ç›®') : 'ç¼–è¾‘é¢˜ç›®';
document.getElementById('saveText').textContent = window.i18n ? window.i18n.translate('question.update_question', 'æ›´æ–°é¢˜ç›®') : 'æ›´æ–°é¢˜ç›®';

// å¡«å……è¡¨å•
document.getElementById('questionSubject').value = question.subject;
document.getElementById('questionSubTag').value = question.sub_tag || '';
document.getElementById('questionDifficulty').value = question.difficulty;
document.getElementById('questionCognitive').value = question.cognitive_level;
document.getElementById('questionType').value = question.type;
document.getElementById('questionPoints').value = question.points;
document.getElementById('questionActive').checked = question.is_active;
document.getElementById('questionContent').value = question.content;
document.getElementById('questionAnswer').value = question.correct_answer;
document.getElementById('questionExplanation').value = question.explanation || '';

// å¤„ç†é€‰æ‹©é¢˜é€‰é¡¹
if (question.type === 'multiple_choice' && question.options) {
document.getElementById('optionsContainer').classList.remove('hidden');
const options = typeof question.options === 'string' ? JSON.parse(question.options) : question.options;
const optionInputs = document.querySelectorAll('.option-input');
optionInputs.forEach((input, index) => {
input.value = options[index] || '';
});
} else {
document.getElementById('optionsContainer').classList.add('hidden');
}

document.getElementById('questionModal').classList.remove('hidden');
}

// éšè—é¢˜ç›®æ¨¡æ€æ¡†
function hideQuestionModal() {
document.getElementById('questionModal').classList.add('hidden');
editingQuestionId = null;
}

// å¤„ç†ä¿å­˜é¢˜ç›®
async function handleSaveQuestion(e) {
e.preventDefault();

const saveBtn = document.getElementById('saveBtn');
const originalText = saveBtn.innerHTML;
saveBtn.disabled = true;
saveBtn.innerHTML = '<i class="ri-loader-4-line animate-spin mr-2"></i>ä¿å­˜ä¸­...';

try {
const formData = {
subject: document.getElementById('questionSubject').value,
sub_tag: document.getElementById('questionSubTag').value,
difficulty: document.getElementById('questionDifficulty').value,
cognitive_level: document.getElementById('questionCognitive').value,
question_type: document.getElementById('questionType').value,
content: document.getElementById('questionContent').value,
correct_answer: document.getElementById('questionAnswer').value,
explanation: document.getElementById('questionExplanation').value,
points: parseInt(document.getElementById('questionPoints').value),
is_active: document.getElementById('questionActive').checked
};

// å¤„ç†é€‰æ‹©é¢˜é€‰é¡¹
if (formData.question_type === 'multiple_choice') {
const options = Array.from(document.querySelectorAll('.option-input')).map(input => input.value.trim()).filter(v => v);
formData.options = options;
}

let response;
if (editingQuestionId) {
response = await fetch(`/api/questions/${editingQuestionId}`, {
method: 'PUT',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify(formData)
});
} else {
response = await fetch('/api/questions', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify(formData)
});
}

const result = await response.json();
if (result.success) {
showSuccess(editingQuestionId ? 'é¢˜ç›®æ›´æ–°æˆåŠŸï¼' : 'é¢˜ç›®åˆ›å»ºæˆåŠŸï¼');
hideQuestionModal();
loadQuestions();
loadStatistics();
} else {
showError('ä¿å­˜å¤±è´¥: ' + result.message);
}
} catch (error) {
console.error('ä¿å­˜é¢˜ç›®å¤±è´¥:', error);
showError('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•');
} finally {
saveBtn.disabled = false;
saveBtn.innerHTML = originalText;
}
}

// åˆ‡æ¢é¢˜ç›®çŠ¶æ€
async function toggleQuestionStatus(questionId, isActive) {
try {
const response = await fetch(`/api/questions/${questionId}`, {
method: 'PUT',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ is_active: isActive })
});

const result = await response.json();
if (result.success) {
showSuccess(`é¢˜ç›®${isActive ? 'æ¿€æ´»' : 'ç¦ç”¨'}æˆåŠŸï¼`);
loadQuestions();
loadStatistics();
} else {
showError('æ“ä½œå¤±è´¥: ' + result.message);
}
} catch (error) {
console.error('åˆ‡æ¢çŠ¶æ€å¤±è´¥:', error);
showError('æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•');
}
}

// åˆ é™¤é¢˜ç›®
async function deleteQuestion(questionId) {
if (!confirm(window.i18n ? window.i18n.translate('question.confirm_delete', 'ç¡®å®šè¦åˆ é™¤è¿™é“é¢˜ç›®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚') : 'ç¡®å®šè¦åˆ é™¤è¿™é“é¢˜ç›®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) return;

try {
const response = await fetch(`/api/questions/${questionId}`, {
method: 'DELETE'
});

const result = await response.json();
if (result.success) {
showSuccess('é¢˜ç›®åˆ é™¤æˆåŠŸï¼');
loadQuestions();
loadStatistics();
} else {
showError('åˆ é™¤å¤±è´¥: ' + result.message);
}
} catch (error) {
console.error('åˆ é™¤é¢˜ç›®å¤±è´¥:', error);
showError('åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•');
}
}

// æ˜¾ç¤ºAIç”Ÿæˆæ¨¡æ€æ¡†
function showAIGenerateModal() {
document.getElementById('aiGenerateModal').classList.remove('hidden');
}

// éšè—AIç”Ÿæˆæ¨¡æ€æ¡†
function hideAIGenerateModal() {
document.getElementById('aiGenerateModal').classList.add('hidden');
}

// å¤„ç†AIç”Ÿæˆ
async function handleAIGenerate(e) {
e.preventDefault();

const generateBtn = document.getElementById('generateBtn');
const originalText = generateBtn.innerHTML;
generateBtn.disabled = true;
generateBtn.innerHTML = '<i class="ri-loader-4-line animate-spin mr-2"></i>ç”Ÿæˆä¸­...';

try {
// è·å–æ–°çš„æ™ºèƒ½ç”Ÿé¢˜é…ç½®
const formData = {
count: parseInt(document.getElementById('aiQuestionCount').value),
subject: document.getElementById('aiSubject').value,
sub_domain: document.getElementById('aiSubDomain').value,
language: document.getElementById('aiLanguage').value,
difficulty: document.getElementById('aiDifficulty').value,
question_type: document.getElementById('aiQuestionType').value,
use_scenarios: document.getElementById('aiUseScenarios').checked,
custom_prompt: document.getElementById('aiCustomPrompt').value,
points_per_question: parseInt(document.getElementById('aiPointsPerQuestion').value),
// å‘åå…¼å®¹
types: [document.getElementById('aiQuestionType').value]
};

const response = await fetch('/api/questions/ai-generate', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify(formData)
});

const result = await response.json();
console.log('AIç”Ÿæˆç»“æœ:', result); // æ·»åŠ è°ƒè¯•æ—¥å¿—
if (result.success) {
showSuccess(`æˆåŠŸç”Ÿæˆ ${result.generated_count} é“é¢˜ç›®ï¼`);
hideAIGenerateModal();
// å»¶è¿Ÿä¸€ä¸‹å†åˆ·æ–°ï¼Œç¡®ä¿æ•°æ®åº“å·²æäº¤
setTimeout(() => {
loadQuestions();
loadStatistics();
}, 500);
} else {
showError('ç”Ÿæˆå¤±è´¥: ' + result.message);
}
} catch (error) {
console.error('AIç”Ÿæˆå¤±è´¥:', error);
showError('ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•');
} finally {
generateBtn.disabled = false;
generateBtn.innerHTML = originalText;
}
}

// åŠ¨æ€åŠ è½½å­é¢†åŸŸé€‰é¡¹
function updateSubDomains() {
    const subDomainSelect = document.getElementById('aiSubDomain');
    const selectedSubject = document.getElementById('aiSubject').value;
    const currentLang = window.i18n ? window.i18n.getCurrentLanguage() : 'zh';
    
    // æ ¹æ®å­¦ç§‘è®¾ç½®å­é¢†åŸŸé€‰é¡¹
    const subDomains = {
        'æ•°å­¦': {
            'å¾®ç§¯åˆ†': 'Calculus',
            'çº¿æ€§ä»£æ•°': 'Linear Algebra',
            'æ¦‚ç‡è®º': 'Probability Theory',
            'æ•°ç†ç»Ÿè®¡': 'Mathematical Statistics',
            'æ•°å€¼åˆ†æ': 'Numerical Analysis',
            'ç¦»æ•£æ•°å­¦': 'Discrete Mathematics'
        },
        'ç‰©ç†': {
            'ç»å…¸åŠ›å­¦': 'Classical Mechanics',
            'ç”µç£å­¦': 'Electromagnetism',
            'çƒ­åŠ›å­¦': 'Thermodynamics',
            'é‡å­ç‰©ç†': 'Quantum Physics',
            'å…‰å­¦': 'Optics',
            'ç›¸å¯¹è®º': 'Relativity'
        },
        'ç»Ÿè®¡å­¦': {
            'æè¿°ç»Ÿè®¡': 'Descriptive Statistics',
            'æ¨æ–­ç»Ÿè®¡': 'Inferential Statistics',
            'å›å½’åˆ†æ': 'Regression Analysis',
            'æ—¶é—´åºåˆ—': 'Time Series',
            'è´å¶æ–¯ç»Ÿè®¡': 'Bayesian Statistics',
            'æœºå™¨å­¦ä¹ ': 'Machine Learning'
        },
        'è®¡ç®—æœºç§‘å­¦': {
            'æ•°æ®ç»“æ„': 'Data Structures',
            'ç®—æ³•è®¾è®¡': 'Algorithm Design',
            'æ•°æ®åº“': 'Database Systems',
            'æ“ä½œç³»ç»Ÿ': 'Operating Systems',
            'ç½‘ç»œå®‰å…¨': 'Network Security',
            'äººå·¥æ™ºèƒ½': 'Artificial Intelligence'
        },
        'å·¥ç¨‹': {
            'ææ–™å·¥ç¨‹': 'Materials Engineering',
            'æœºæ¢°å·¥ç¨‹': 'Mechanical Engineering',
            'ç”µæ°”å·¥ç¨‹': 'Electrical Engineering',
            'åŒ–å­¦å·¥ç¨‹': 'Chemical Engineering',
            'åœŸæœ¨å·¥ç¨‹': 'Civil Engineering',
            'è½¯ä»¶å·¥ç¨‹': 'Software Engineering'
        }
    };
    
    // è®¾ç½®æ–°é€‰é¡¹
    const generalText = currentLang === 'en' ? 'General' : 'é€šç”¨';
    subDomainSelect.innerHTML = `<option value="">${generalText}</option>`;
    
    if (subDomains[selectedSubject]) {
        for (const [zh, en] of Object.entries(subDomains[selectedSubject])) {
            const option = document.createElement('option');
            option.value = zh;
            
            if (currentLang === 'en') {
                option.textContent = en;
            } else {
                option.textContent = `${zh} (${en})`;
            }
            
            subDomainSelect.appendChild(option);
        }
    }
}

document.getElementById('aiSubject').addEventListener('change', updateSubDomains);

// åœºæ™¯è®¾ç½®åˆ‡æ¢åŠŸèƒ½
document.getElementById('aiUseScenarios').addEventListener('change', function() {
    const examples = document.getElementById('scenarioExamples');
    if (this.checked) {
        examples.classList.remove('hidden');
    } else {
        examples.classList.add('hidden');
    }
});

// AIç”Ÿé¢˜é¡µé¢å¤šè¯­è¨€æ”¯æŒ
const aiTranslations = {
    zh: {
        'ai_generate.title': 'æ™ºèƒ½AIç”Ÿé¢˜åŠ©æ‰‹',
        'ai_generate.basic_settings': 'åŸºç¡€è®¾ç½®',
        'ai_generate.question_count': 'é¢˜ç›®æ•°é‡',
        'ai_generate.question_language': 'é¢˜ç›®è¯­è¨€',
        'ai_generate.points_per_question': 'æ¯é¢˜åˆ†å€¼',
        'ai_generate.subject_and_domain': 'å­¦ç§‘ä¸é¢†åŸŸ',
        'ai_generate.main_subject': 'ä¸»è¦å­¦ç§‘',
        'ai_generate.sub_domain': 'å­é¢†åŸŸ (å¯é€‰)',
        'ai_generate.select_subject_first': 'è¯·å…ˆé€‰æ‹©ä¸»è¦å­¦ç§‘',
        'ai_generate.difficulty_and_type': 'éš¾åº¦ä¸é¢˜å‹',
        'ai_generate.difficulty_level': 'éš¾åº¦ç­‰çº§',
        'ai_generate.question_type': 'é¢˜ç›®ç±»å‹',
        'ai_generate.basic_education': 'â”â”â” åŸºç¡€æ•™è‚² â”â”â”',
        'ai_generate.high_school': 'ğŸ“ é«˜ä¸­æ°´å¹³',
        'ai_generate.undergraduate_basic': 'ğŸ“š æœ¬ç§‘åŸºç¡€',
        'ai_generate.undergraduate_advanced': 'ğŸ¯ æœ¬ç§‘é«˜çº§',
        'ai_generate.standardized_tests': 'â”â”â” æ ‡å‡†åŒ–è€ƒè¯• â”â”â”',
        'ai_generate.gre_level': 'ğŸ¯ GREéš¾åº¦',
        'ai_generate.academic_research': 'â”â”â” å­¦æœ¯ç ”ç©¶ â”â”â”',
        'ai_generate.graduate_study': 'ğŸ›ï¸ ç ”ç©¶ç”Ÿæ°´å¹³',
        'ai_generate.doctoral_research': 'ğŸ”¬ åšå£«ç ”ç©¶',
        'ai_generate.multiple_choice': 'ğŸ“ é€‰æ‹©é¢˜',
        'ai_generate.short_answer': 'ğŸ“„ ç®€ç­”é¢˜',
        'ai_generate.programming': 'ğŸ’» ç¼–ç¨‹é¢˜',
        'ai_generate.true_false': 'âœ… åˆ¤æ–­é¢˜',
        'ai_generate.fill_blank': 'ğŸ“ å¡«ç©ºé¢˜',
        'ai_generate.essay': 'ğŸ“– è®ºè¿°é¢˜',
        'ai_generate.scenario_settings': 'åœºæ™¯è®¾ç½®',
        'ai_generate.use_real_scenarios': 'ä½¿ç”¨çœŸå®åº”ç”¨åœºæ™¯é¢˜ç›®',
        'ai_generate.rich_background': 'ï¼ˆæä¾›ä¸°å¯Œçš„èƒŒæ™¯ç¯å¢ƒæè¿°ï¼‰',
        'ai_generate.scenario_examples': 'åœºæ™¯ç±»å‹ç¤ºä¾‹ï¼š',
        'ai_generate.engineering_project': 'ğŸ­ å·¥ç¨‹é¡¹ç›®',
        'ai_generate.scientific_research': 'ğŸ”¬ ç§‘å­¦ç ”ç©¶',
        'ai_generate.business_decision': 'ğŸ’¼ å•†ä¸šå†³ç­–',
        'ai_generate.laboratory_environment': 'ğŸ¯ å®éªŒå®¤ç¯å¢ƒ',
        'ai_generate.custom_prompt': 'è‡ªå®šä¹‰æç¤ºè¯ï¼ˆå¯é€‰ï¼‰',
        'ai_generate.custom_prompt_placeholder': 'è¾“å…¥é¢å¤–çš„é¢˜ç›®è¦æ±‚...',
        'ai_generate.generate_questions': 'ç”Ÿæˆé¢˜ç›®',
        'common.cancel': 'å–æ¶ˆ'
    },
    en: {
        'ai_generate.title': 'Smart AI Question Generator',
        'ai_generate.basic_settings': 'Basic Settings',
        'ai_generate.question_count': 'Question Count',
        'ai_generate.question_language': 'Question Language',
        'ai_generate.points_per_question': 'Points per Question',
        'ai_generate.subject_and_domain': 'Subject & Domain',
        'ai_generate.main_subject': 'Main Subject',
        'ai_generate.sub_domain': 'Sub-domain (Optional)',
        'ai_generate.select_subject_first': 'Please select main subject first',
        'ai_generate.difficulty_and_type': 'Difficulty & Type',
        'ai_generate.difficulty_level': 'Difficulty Level',
        'ai_generate.question_type': 'Question Type',
        'ai_generate.basic_education': 'â”â”â” Basic Education â”â”â”',
        'ai_generate.high_school': 'ğŸ“ High School Level',
        'ai_generate.undergraduate_basic': 'ğŸ“š Undergraduate Basic',
        'ai_generate.undergraduate_advanced': 'ğŸ¯ Undergraduate Advanced',
        'ai_generate.standardized_tests': 'â”â”â” Standardized Tests â”â”â”',
        'ai_generate.gre_level': 'ğŸ¯ GRE Level',
        'ai_generate.academic_research': 'â”â”â” Academic Research â”â”â”',
        'ai_generate.graduate_study': 'ğŸ›ï¸ Graduate Study',
        'ai_generate.doctoral_research': 'ğŸ”¬ Doctoral Research',
        'ai_generate.multiple_choice': 'ğŸ“ Multiple Choice',
        'ai_generate.short_answer': 'ğŸ“„ Short Answer',
        'ai_generate.programming': 'ğŸ’» Programming',
        'ai_generate.true_false': 'âœ… True/False',
        'ai_generate.fill_blank': 'ğŸ“ Fill in the Blank',
        'ai_generate.essay': 'ğŸ“– Essay',
        'ai_generate.scenario_settings': 'Scenario Settings',
        'ai_generate.use_real_scenarios': 'Use real-world application scenarios',
        'ai_generate.rich_background': '(Provides rich background descriptions)',
        'ai_generate.scenario_examples': 'Scenario Examples:',
        'ai_generate.engineering_project': 'ğŸ­ Engineering Project',
        'ai_generate.scientific_research': 'ğŸ”¬ Scientific Research',
        'ai_generate.business_decision': 'ğŸ’¼ Business Decision',
        'ai_generate.laboratory_environment': 'ğŸ¯ Laboratory Environment',
        'ai_generate.custom_prompt': 'Custom Prompt (Optional)',
        'ai_generate.custom_prompt_placeholder': 'Enter additional question requirements...',
        'ai_generate.generate_questions': 'Generate Questions',
        'common.cancel': 'Cancel'
    }
};

// æ›´æ–°AIç”Ÿé¢˜é¡µé¢çš„å¤šè¯­è¨€å†…å®¹
function updateAIGenerateTranslations() {
    const currentLang = window.i18n ? window.i18n.getCurrentLanguage() : 'zh';
    const translations = aiTranslations[currentLang] || aiTranslations.zh;
    
    // æ›´æ–°æ‰€æœ‰å¸¦æœ‰data-i18nå±æ€§çš„å…ƒç´ ï¼ˆæ’é™¤selecté€‰é¡¹ï¼‰
    const elements = document.querySelectorAll('#aiGenerateModal [data-i18n]:not(option):not(optgroup)');
    elements.forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (translations[key]) {
            element.textContent = translations[key];
        }
    });
    
    // æ›´æ–°æ‰€æœ‰å¸¦æœ‰data-i18n-placeholderå±æ€§çš„å…ƒç´ 
    const placeholderElements = document.querySelectorAll('#aiGenerateModal [data-i18n-placeholder]');
    placeholderElements.forEach(element => {
        const key = element.getAttribute('data-i18n-placeholder');
        if (translations[key]) {
            element.placeholder = translations[key];
        }
    });
    
    // æ›´æ–°å­¦ç§‘é€‰é¡¹
    updateSubjectOptions(currentLang);
    
    // é‡æ–°æ„å»ºéš¾åº¦é€‰æ‹©å™¨ä»¥ç¡®ä¿optgroupæ­£ç¡®æ˜¾ç¤º
    updateDifficultySelect(currentLang, translations);
    
    // æ›´æ–°é¢˜ç›®ç±»å‹é€‰é¡¹
    const typeOptions = document.querySelectorAll('#aiQuestionType option');
    typeOptions.forEach(option => {
        const key = option.getAttribute('data-i18n');
        if (translations[key]) {
            option.textContent = translations[key];
        }
    });
}

// é‡æ–°æ„å»ºéš¾åº¦é€‰æ‹©å™¨
function updateDifficultySelect(currentLang, translations) {
    const difficultySelect = document.getElementById('aiDifficulty');
    const currentValue = difficultySelect.value;
    
    const basicEducationLabel = translations['ai_generate.basic_education'] || 'â”â”â” åŸºç¡€æ•™è‚² â”â”â”';
    const standardizedTestsLabel = translations['ai_generate.standardized_tests'] || 'â”â”â” æ ‡å‡†åŒ–è€ƒè¯• â”â”â”';
    const academicResearchLabel = translations['ai_generate.academic_research'] || 'â”â”â” å­¦æœ¯ç ”ç©¶ â”â”â”';
    
    const highSchoolText = translations['ai_generate.high_school'] || 'ğŸ“ é«˜ä¸­æ°´å¹³';
    const undergraduateBasicText = translations['ai_generate.undergraduate_basic'] || 'ğŸ“š æœ¬ç§‘åŸºç¡€';
    const undergraduateAdvancedText = translations['ai_generate.undergraduate_advanced'] || 'ğŸ¯ æœ¬ç§‘é«˜çº§';
    const greLevelText = translations['ai_generate.gre_level'] || 'ğŸ¯ GREéš¾åº¦';
    const graduateStudyText = translations['ai_generate.graduate_study'] || 'ğŸ›ï¸ ç ”ç©¶ç”Ÿæ°´å¹³';
    const doctoralResearchText = translations['ai_generate.doctoral_research'] || 'ğŸ”¬ åšå£«ç ”ç©¶';
    
    difficultySelect.innerHTML = `
        <optgroup label="${basicEducationLabel}">
            <option value="high_school">${highSchoolText}</option>
            <option value="undergraduate_basic">${undergraduateBasicText}</option>
            <option value="undergraduate_advanced">${undergraduateAdvancedText}</option>
        </optgroup>
        <optgroup label="${standardizedTestsLabel}">
            <option value="gre_level">${greLevelText}</option>
        </optgroup>
        <optgroup label="${academicResearchLabel}">
            <option value="graduate_study">${graduateStudyText}</option>
            <option value="doctoral_research">${doctoralResearchText}</option>
        </optgroup>
    `;
    
    // æ¢å¤ä¹‹å‰é€‰ä¸­çš„å€¼
    difficultySelect.value = currentValue || 'undergraduate_basic';
}

// æ›´æ–°å­¦ç§‘é€‰é¡¹çš„æ˜¾ç¤ºæ–‡æœ¬
function updateSubjectOptions(lang) {
    const subjectSelect = document.getElementById('aiSubject');
    const options = subjectSelect.querySelectorAll('option');
    
    const subjectTranslations = {
        zh: {
            'æ•°å­¦': 'ğŸ“ æ•°å­¦ (Mathematics)',
            'ç‰©ç†': 'âš›ï¸ ç‰©ç† (Physics)', 
            'ç»Ÿè®¡å­¦': 'ğŸ“Š ç»Ÿè®¡å­¦ (Statistics)',
            'è®¡ç®—æœºç§‘å­¦': 'ğŸ’» è®¡ç®—æœºç§‘å­¦ (Computer Science)',
            'å·¥ç¨‹': 'âš™ï¸ å·¥ç¨‹ (Engineering)'
        },
        en: {
            'æ•°å­¦': 'ğŸ“ Mathematics',
            'ç‰©ç†': 'âš›ï¸ Physics',
            'ç»Ÿè®¡å­¦': 'ğŸ“Š Statistics', 
            'è®¡ç®—æœºç§‘å­¦': 'ğŸ’» Computer Science',
            'å·¥ç¨‹': 'âš™ï¸ Engineering'
        }
    };
    
    const translations = subjectTranslations[lang] || subjectTranslations.zh;
    
    options.forEach(option => {
        const value = option.value;
        if (translations[value]) {
            option.textContent = translations[value];
        }
    });
}

// ç›‘å¬è¯­è¨€åˆ‡æ¢äº‹ä»¶
document.addEventListener('i18n:languageChanged', function(e) {
    updateAIGenerateTranslations();
    updateSubDomains(); // åŒæ—¶æ›´æ–°å­é¢†åŸŸé€‰é¡¹
});

// åˆå§‹åŒ–æ—¶ä¹Ÿæ›´æ–°ä¸€æ¬¡
document.addEventListener('i18n:initialized', function() {
    updateAIGenerateTranslations();
    updateSubDomains(); // åŒæ—¶æ›´æ–°å­é¢†åŸŸé€‰é¡¹
});

// æ˜¾ç¤ºæ‰¹é‡æ“ä½œæ¨¡æ€æ¡†
function showBulkModal() {
if (selectedQuestions.size === 0) {
showError('è¯·å…ˆé€‰æ‹©è¦æ“ä½œçš„é¢˜ç›®');
return;
}

updateSelectedCount();

// æ›´æ–°æ¨¡æ€æ¡†æ ‡é¢˜æ˜¾ç¤ºé€‰ä¸­æ•°é‡
const modalTitle = document.querySelector('#bulkModal h3');
if (modalTitle) {
modalTitle.textContent = `æ‰¹é‡æ“ä½œ (å·²é€‰æ‹© ${selectedQuestions.size} é“é¢˜ç›®)`;
}

// æ›´æ–°æŒ‰é’®æ–‡æœ¬æ˜¾ç¤ºæ•°é‡
const bulkActivateBtn = document.getElementById('bulkActivateBtn');
const bulkDeactivateBtn = document.getElementById('bulkDeactivateBtn');
const bulkDeleteBtn = document.getElementById('bulkDeleteBtn');

if (bulkActivateBtn) {
bulkActivateBtn.innerHTML = `<i class="ri-check-circle-line text-green-600 mr-2"></i>æ‰¹é‡å¯ç”¨ (${selectedQuestions.size}é“)`;
}
if (bulkDeactivateBtn) {
bulkDeactivateBtn.innerHTML = `<i class="ri-close-circle-line text-yellow-600 mr-2"></i>æ‰¹é‡ç¦ç”¨ (${selectedQuestions.size}é“)`;
}
if (bulkDeleteBtn) {
bulkDeleteBtn.innerHTML = `<i class="ri-delete-bin-line text-red-600 mr-2"></i>æ‰¹é‡åˆ é™¤ (${selectedQuestions.size}é“)`;
}

document.getElementById('bulkModal').classList.remove('hidden');
}

// éšè—æ‰¹é‡æ“ä½œæ¨¡æ€æ¡†
function hideBulkModal() {
document.getElementById('bulkModal').classList.add('hidden');
}

// æ›´æ–°é€‰ä¸­æ•°é‡
function updateSelectedCount() {
document.getElementById('selectedCount').textContent = selectedQuestions.size;
}

// å¤„ç†æ‰¹é‡æ“ä½œ
async function handleBulkAction(action) {
if (selectedQuestions.size === 0) {
showError('è¯·å…ˆé€‰æ‹©è¦æ“ä½œçš„é¢˜ç›®');
return;
}

let confirmMessage = '';
let endpoint = '';
let method = 'POST';
let body = {};

switch (action) {
case 'activate':
confirmMessage = `ç¡®å®šè¦æ¿€æ´»é€‰ä¸­çš„ ${selectedQuestions.size} é“é¢˜ç›®å—ï¼Ÿ`;
endpoint = '/api/questions/batch-update';
body = { question_ids: Array.from(selectedQuestions), is_active: true };
method = 'PUT';
break;
case 'deactivate':
confirmMessage = `ç¡®å®šè¦ç¦ç”¨é€‰ä¸­çš„ ${selectedQuestions.size} é“é¢˜ç›®å—ï¼Ÿ`;
endpoint = '/api/questions/batch-update';
body = { question_ids: Array.from(selectedQuestions), is_active: false };
method = 'PUT';
break;
case 'delete':
confirmMessage = `ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${selectedQuestions.size} é“é¢˜ç›®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`;
endpoint = '/api/questions/batch-delete';
method = 'DELETE';
body = { question_ids: Array.from(selectedQuestions) };
break;
}

if (!confirm(confirmMessage)) return;

try {
const response = await fetch(endpoint, {
method: method,
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify(body)
});

const result = await response.json();
if (result.success) {
showSuccess('æ‰¹é‡æ“ä½œæˆåŠŸï¼');
selectedQuestions.clear();
hideBulkModal();
loadQuestions();
loadStatistics();
} else {
showError('æ“ä½œå¤±è´¥: ' + result.message);
}
} catch (error) {
console.error('æ‰¹é‡æ“ä½œå¤±è´¥:', error);
showError('æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•');
}
}

// å¤„ç†ç™»å‡º
async function handleLogout() {
try {
const response = await fetch('/api/admin/logout', {
method: 'POST',
headers: { 'Content-Type': 'application/json' }
});
const result = await response.json();
if (result.success) {
window.location.href = '/';
}
} catch (error) {
console.error('ç™»å‡ºå¤±è´¥:', error);
}
}

// å·¥å…·å‡½æ•°
function getSubjectColor(subject) {
const colors = {
'æ•°å­¦': 'bg-blue-500',
'ç»Ÿè®¡å­¦': 'bg-indigo-500',
'è®¡ç®—æœºç§‘å­¦': 'bg-purple-500',
'å·¥ç¨‹': 'bg-orange-500'
};
return colors[subject] || 'bg-gray-500';
}

function getSubjectName(subject) {
if (window.i18n && window.i18n.initialized) {
    const subjectMap = {
        'æ•°å­¦': window.i18n.translate('subject.math', 'æ•°å­¦'),
        'ç»Ÿè®¡å­¦': window.i18n.translate('subject.statistics', 'ç»Ÿè®¡å­¦'),
        'è®¡ç®—æœºç§‘å­¦': window.i18n.translate('subject.computer_science', 'è®¡ç®—æœºç§‘å­¦'),
        'å·¥ç¨‹': window.i18n.translate('subject.engineering', 'å·¥ç¨‹')
    };
    return subjectMap[subject] || subject;
} else {
    return subject || 'æœªçŸ¥';
}
}

function getDifficultyColor(difficulty) {
const colors = {
'high_school': 'bg-green-100 text-green-800',
'undergraduate_basic': 'bg-blue-100 text-blue-800',
'undergraduate_advanced': 'bg-yellow-100 text-yellow-800',
'graduate': 'bg-red-100 text-red-800'
};
return colors[difficulty] || 'bg-gray-100 text-gray-800';
}

function getDifficultyName(difficulty) {
if (window.i18n && window.i18n.initialized) {
    const difficultyMap = {
        'high_school': window.i18n.translate('difficulty.high_school', 'é«˜ä¸­æ°´å¹³'),
        'undergraduate_basic': window.i18n.translate('difficulty.undergraduate_basic', 'æœ¬ç§‘åŸºç¡€'),
        'undergraduate_advanced': window.i18n.translate('difficulty.undergraduate_advanced', 'æœ¬ç§‘é«˜çº§'),
        'graduate': window.i18n.translate('difficulty.graduate', 'ç ”ç©¶ç”Ÿæ°´å¹³')
    };
    return difficultyMap[difficulty] || difficulty;
} else {
    const difficultyNames = {
        'high_school': 'é«˜ä¸­æ°´å¹³',
        'undergraduate_basic': 'æœ¬ç§‘åŸºç¡€',
        'undergraduate_advanced': 'æœ¬ç§‘é«˜çº§',
        'graduate': 'ç ”ç©¶ç”Ÿæ°´å¹³'
    };
    return difficultyNames[difficulty] || difficulty || 'æœªçŸ¥';
}
}

function getTypeColor(type) {
const colors = {
'multiple_choice': 'bg-blue-100 text-blue-800',
'short_answer': 'bg-purple-100 text-purple-800',
'programming': 'bg-indigo-100 text-indigo-800'
};
return colors[type] || 'bg-gray-100 text-gray-800';
}

function getTypeName(type) {
if (window.i18n && window.i18n.initialized) {
    const typeMap = {
        'multiple_choice': window.i18n.translate('question.type.multiple_choice', 'é€‰æ‹©é¢˜'),
        'short_answer': window.i18n.translate('question.type.short_answer', 'ç®€ç­”é¢˜'),
        'programming': window.i18n.translate('question.type.programming', 'ç¼–ç¨‹é¢˜')
    };
    return typeMap[type] || type;
} else {
    const names = {
        'multiple_choice': 'é€‰æ‹©é¢˜',
        'short_answer': 'ç®€ç­”é¢˜',
        'programming': 'ç¼–ç¨‹é¢˜'
    };
    return names[type] || type;
}
}

// æ¸…ç©ºæ‰€æœ‰é¢˜ç›®
async function handleClearAll() {
console.log('æ¸…ç©ºæ‰€æœ‰é¢˜ç›®');

const confirmMessage = 'âš ï¸ ç¡®å®šè¦æ¸…ç©ºé¢˜åº“ä¸­çš„æ‰€æœ‰é¢˜ç›®å—ï¼Ÿ\n\næ­¤æ“ä½œå°†åˆ é™¤æ‰€æœ‰é¢˜ç›®ï¼ŒåŒ…æ‹¬ï¼š\n- æ‰€æœ‰å·²ç”Ÿæˆçš„é¢˜ç›®\n- æ‰€æœ‰æ‰‹åŠ¨åˆ›å»ºçš„é¢˜ç›®\n- æ‰€æœ‰å¯¼å…¥çš„é¢˜ç›®\n\næ­¤æ“ä½œä¸å¯æ¢å¤ï¼Œè¯·è°¨æ…æ“ä½œï¼';

if (!confirm(confirmMessage)) {
console.log('ç”¨æˆ·å–æ¶ˆæ¸…ç©ºæ“ä½œ');
return;
}

// äºŒæ¬¡ç¡®è®¤
const doubleConfirm = prompt('è¯·è¾“å…¥ "CLEAR ALL" æ¥ç¡®è®¤æ¸…ç©ºæ“ä½œï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰ï¼š');
if (doubleConfirm !== 'CLEAR ALL') {
console.log('äºŒæ¬¡ç¡®è®¤å¤±è´¥');
showError('ç¡®è®¤å¤±è´¥ï¼Œæ“ä½œå·²å–æ¶ˆ');
return;
}

try {
showLoading(true);
console.log('å¼€å§‹æ¸…ç©ºæ‰€æœ‰é¢˜ç›®...');

const response = await fetch('/api/questions/clear-all', {
method: 'DELETE',
headers: {
'Content-Type': 'application/json'
}
});

const result = await response.json();
console.log('æ¸…ç©ºç»“æœ:', result);

if (result.success) {
showSuccess(result.message);
hideBulkModal();
// æ¸…ç©ºé€‰ä¸­çŠ¶æ€
selectedQuestions.clear();
updateSelectedCount();
// é‡æ–°åŠ è½½é¢˜ç›®åˆ—è¡¨å’Œç»Ÿè®¡
loadQuestions();
loadStatistics();
} else {
showError('æ¸…ç©ºå¤±è´¥: ' + result.message);
}
} catch (error) {
console.error('æ¸…ç©ºé¢˜ç›®å¤±è´¥:', error);
showError('æ¸…ç©ºå¤±è´¥ï¼Œè¯·é‡è¯•');
} finally {
showLoading(false);
}
}

function formatDate(dateString) {
if (!dateString) return 'æœªçŸ¥æ—¶é—´';
try {
return new Date(dateString).toLocaleDateString('zh-CN');
} catch (error) {
console.error('æ—¥æœŸæ ¼å¼åŒ–é”™è¯¯:', error, dateString);
return 'æ—¶é—´æ ¼å¼é”™è¯¯';
}
}

function debounce(func, wait) {
let timeout;
return function executedFunction(...args) {
const later = () => {
clearTimeout(timeout);
func(...args);
};
clearTimeout(timeout);
timeout = setTimeout(later, wait);
};
}

function showLoading(show) {
// å¯ä»¥æ·»åŠ åŠ è½½æŒ‡ç¤ºå™¨
}

function showSuccess(message) {
// ç®€å•çš„æˆåŠŸæç¤º
alert('âœ… ' + message);
}

// æ˜¾ç¤ºé¢˜ç›®è¯¦æƒ…
async function showQuestionDetail(questionId) {
    try {
        // æŸ¥çœ‹é¢˜ç›®è¯¦æƒ…
        
        const response = await fetch(`/api/questions/${questionId}`);
        if (!response.ok) {
            throw new Error('è·å–é¢˜ç›®è¯¦æƒ…å¤±è´¥');
        }
        
        const result = await response.json();
        if (result.success) {
            const question = result.question;
            renderQuestionDetail(question);
            document.getElementById('questionDetailModal').classList.remove('hidden');
        } else {
            showError('è·å–é¢˜ç›®è¯¦æƒ…å¤±è´¥: ' + result.message);
        }
    } catch (error) {
        console.error('è·å–é¢˜ç›®è¯¦æƒ…å¤±è´¥:', error);
        showError('è·å–é¢˜ç›®è¯¦æƒ…å¤±è´¥ï¼Œè¯·é‡è¯•');
    }
}

// æ¸²æŸ“é¢˜ç›®è¯¦æƒ…
function renderQuestionDetail(question) {
    const container = document.getElementById('questionDetailContent');
    
    // æ ¼å¼åŒ–é€‰é¡¹æ˜¾ç¤º
    let optionsHtml = '';
    if (question.type === 'multiple_choice' && question.options && question.options.length > 0) {
        optionsHtml = `
            <div class="bg-gray-50 p-4 rounded-lg">
                <h4 class="font-medium text-gray-900 mb-3">é€‰é¡¹</h4>
                <div class="space-y-2">
                    ${question.options.map((option, index) => {
                        const label = String.fromCharCode(65 + index); // A, B, C, D
                        const isCorrect = option === question.correct_answer;
                        return `
                            <div class="flex items-center p-2 rounded ${isCorrect ? 'bg-green-100 border border-green-300' : 'bg-white border border-gray-200'}">
                                <span class="font-medium text-gray-700 w-8">${label}.</span>
                                <span class="text-gray-900 math-content">${option}</span>
                                ${isCorrect ? '<i class="ri-check-circle-fill text-green-600 ml-auto"></i>' : ''}
                            </div>
                        `;
                    }).join('')}
                </div>
            </div>
        `;
    }
    
    container.innerHTML = `
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- åŸºæœ¬ä¿¡æ¯ -->
            <div class="space-y-4">
                <div class="bg-blue-50 p-4 rounded-lg">
                    <h4 class="font-medium text-blue-900 mb-3">åŸºæœ¬ä¿¡æ¯</h4>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-blue-700">é¢˜ç›®ID:</span>
                            <span class="font-medium">${question.id}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-blue-700">å­¦ç§‘:</span>
                            <span class="font-medium">${question.subject}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-blue-700">å­æ ‡ç­¾:</span>
                            <span class="font-medium">${question.sub_tag || 'æ— '}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-blue-700">è¯­è¨€:</span>
                            <span class="font-medium">${question.language === 'zh' ? 'ä¸­æ–‡' : 'è‹±æ–‡'}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-blue-700">éš¾åº¦:</span>
                            <span class="font-medium">${question.difficulty}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-blue-700">é¢˜å‹:</span>
                            <span class="font-medium">${getTypeName(question.type)}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-blue-700">åˆ†å€¼:</span>
                            <span class="font-medium">${question.points || 1}åˆ†</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-blue-700">çŠ¶æ€:</span>
                            <span class="font-medium ${question.is_active ? 'text-green-600' : 'text-gray-500'}">
                                ${question.is_active ? 
                                    (window.i18n && window.i18n.initialized ? window.i18n.translate('question.status.active', 'å·²æ¿€æ´»') : 'å·²æ¿€æ´»') : 
                                    (window.i18n && window.i18n.initialized ? window.i18n.translate('question.status.inactive', 'æœªæ¿€æ´»') : 'æœªæ¿€æ´»')
                                }
                            </span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-blue-700">åˆ›å»ºæ—¶é—´:</span>
                            <span class="font-medium">${formatDate(question.created_at)}</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- é¢˜ç›®å†…å®¹ -->
            <div class="space-y-4">
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-medium text-gray-900 mb-3">é¢˜ç›®å†…å®¹</h4>
                    <div class="text-gray-800 leading-relaxed math-content">${question.content}</div>
                </div>
            </div>
        </div>
        
        ${optionsHtml}
        
        <!-- æ­£ç¡®ç­”æ¡ˆ -->
        <div class="bg-green-50 p-4 rounded-lg">
            <h4 class="font-medium text-green-900 mb-3">æ­£ç¡®ç­”æ¡ˆ</h4>
            <div class="text-green-800 font-medium math-content">${question.correct_answer}</div>
        </div>
        
        <!-- é¢˜ç›®è§£æ -->
        <div class="bg-yellow-50 p-4 rounded-lg">
            <h4 class="font-medium text-yellow-900 mb-3">é¢˜ç›®è§£æ</h4>
            <div class="text-yellow-800 leading-relaxed math-content">${question.explanation || 'æš‚æ— è§£æ'}</div>
        </div>
    `;
    
    // æ¸²æŸ“æ•°å­¦å…¬å¼
    renderMathJaxForQuestionDetail();
}

// éšè—é¢˜ç›®è¯¦æƒ…æ¨¡æ€æ¡†
function hideQuestionDetailModal() {
    document.getElementById('questionDetailModal').classList.add('hidden');
}

function showError(message) {
// ç®€å•çš„é”™è¯¯æç¤º
alert('âŒ ' + message);
}

// æ¸²æŸ“æ•°å­¦å…¬å¼
function renderMathJaxForQuestions() {
    // æ£€æŸ¥å®¹å™¨æ˜¯å¦å­˜åœ¨
    const container = document.getElementById('questionsContainer');
    if (!container) {
        return;
    }
    
    // æ£€æŸ¥æ˜¯å¦æœ‰éœ€è¦æ¸²æŸ“çš„å†…å®¹
    const mathElements = container.querySelectorAll('.math-content');
    
    if (mathElements.length === 0) {
        return;
    }
    
    // å°è¯•å¤šç§æ¸²æŸ“æ–¹æ³•
    if (window.MathJax) {
        
        // æ–¹æ³•1: ä½¿ç”¨ typesetPromise (MathJax 3.x æ¨èæ–¹æ³•)
        if (window.MathJax.typesetPromise) {
            window.MathJax.typesetPromise([container])
                .then(() => {
                    // æ£€æŸ¥æ¸²æŸ“ç»“æœ
                    const renderedElements = container.querySelectorAll('.MathJax, .mjx-chtml, .mjx-math, mjx-container');
                    
                    if (renderedElements.length === 0) {
                        tryAlternativeRender();
                    }
                })
                .catch((err) => {
                    console.warn('MathJax æ¸²æŸ“å¤±è´¥:', err);
                    tryAlternativeRender();
                });
        } 
        // æ–¹æ³•2: ä½¿ç”¨ startup.document.rerender
        else if (window.MathJax.startup && window.MathJax.startup.document) {
            // ä½¿ç”¨ startup.document.rerender æ–¹æ³•æ¸²æŸ“
            try {
                window.MathJax.startup.document.clear();
                window.MathJax.startup.document.updateDocument();
                // startup.document æ¸²æŸ“å®Œæˆ
            } catch (err) {
                console.warn('MathJax æ¸²æŸ“å¤±è´¥:', err);
                tryAlternativeRender();
            }
        }
        // æ–¹æ³•3: å…¶ä»–å¤‡ç”¨æ–¹æ³•
        else {
            tryAlternativeRender();
        }
        
        // å¤‡ç”¨æ¸²æŸ“æ–¹æ³•
        function tryAlternativeRender() {
            // å°è¯•å¤‡ç”¨æ¸²æŸ“æ–¹æ³•
            
            // æ–¹æ³•3: æ‰‹åŠ¨å¤„ç†æ¯ä¸ªæ•°å­¦å…ƒç´ 
            if (window.MathJax.tex2chtml) {
                // ä½¿ç”¨ tex2chtml æ‰‹åŠ¨æ¸²æŸ“
                mathElements.forEach((elem, index) => {
                    if (elem.textContent.includes('$')) {
                        try {
                            const mathText = elem.textContent;
                            // æå–æ•°å­¦å…¬å¼
                            const mathMatch = mathText.match(/\$([^$]+)\$/g);
                            if (mathMatch) {
                                let newHTML = mathText;
                                mathMatch.forEach(match => {
                                    const tex = match.slice(1, -1); // ç§»é™¤ $ ç¬¦å·
                                    try {
                                        const rendered = window.MathJax.tex2chtml(tex);
                                        newHTML = newHTML.replace(match, rendered.outerHTML);
                                    } catch (e) {
                                        console.warn(`æ¸²æŸ“å…¬å¼å¤±è´¥: ${tex}`, e);
                                    }
                                });
                                elem.innerHTML = newHTML;
                                // æ‰‹åŠ¨æ¸²æŸ“å…ƒç´ å®Œæˆ
                            }
                        } catch (e) {
                            console.warn(`æ‰‹åŠ¨æ¸²æŸ“å…ƒç´  ${index + 1} å¤±è´¥:`, e);
                        }
                    }
                });
            }
            // æ–¹æ³•4: ä½¿ç”¨ MathJax.Hub (MathJax 2.x å…¼å®¹)
            else if (window.MathJax.Hub && window.MathJax.Hub.Queue) {
                // ä½¿ç”¨ MathJax.Hub.Queue æ¸²æŸ“
                window.MathJax.Hub.Queue(["Typeset", window.MathJax.Hub, container]);
            }
            else {
                console.warn('æ‰€æœ‰æ¸²æŸ“æ–¹æ³•éƒ½ä¸å¯ç”¨');
            }
        }
    } else {
        // MathJax å°šæœªåŠ è½½å®Œæˆï¼Œå»¶è¿Ÿæ¸²æŸ“
        setTimeout(() => renderMathJaxForQuestions(), 500);
    }
}

// æ¸²æŸ“é¢˜ç›®è¯¦æƒ…ä¸­çš„æ•°å­¦å…¬å¼
function renderMathJaxForQuestionDetail() {
    // å¼€å§‹æ¸²æŸ“é¢˜ç›®è¯¦æƒ…æ•°å­¦å…¬å¼
    
    if (window.MathJax && window.MathJax.typesetPromise) {
        // MathJax å·²åŠ è½½ï¼Œå¼€å§‹æ¸²æŸ“é¢˜ç›®è¯¦æƒ…
        
        // é‡æ–°æ¸²æŸ“é¢˜ç›®è¯¦æƒ…æ¨¡æ€æ¡†ä¸­çš„æ•°å­¦å…¬å¼
        window.MathJax.typesetPromise([document.getElementById('questionDetailContent')])
            .then(() => {
                // é¢˜ç›®è¯¦æƒ…æ•°å­¦å…¬å¼æ¸²æŸ“å®Œæˆ
            })
            .catch((err) => {
                console.warn('é¢˜ç›®è¯¦æƒ…æ•°å­¦å…¬å¼æ¸²æŸ“å¤±è´¥:', err);
            });
    } else {
        // MathJax å°šæœªåŠ è½½å®Œæˆï¼Œå»¶è¿Ÿæ¸²æŸ“é¢˜ç›®è¯¦æƒ…
        // å¦‚æœMathJaxè¿˜æ²¡æœ‰åŠ è½½å®Œæˆï¼Œå»¶è¿Ÿæ¸²æŸ“
        setTimeout(() => renderMathJaxForQuestionDetail(), 200);
    }
}
</script>

<!-- Question Detail Modal -->
<div id="questionDetailModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center p-4 hidden z-50">
    <div class="bg-white rounded-2xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto">
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-xl font-semibold text-gray-900">é¢˜ç›®è¯¦æƒ…</h3>
            <button id="closeDetailModalBtn" class="text-gray-400 hover:text-gray-600">
                <i class="ri-close-line text-xl"></i>
            </button>
        </div>
        
        <div id="questionDetailContent" class="space-y-6">
            <!-- é¢˜ç›®è¯¦ç»†ä¿¡æ¯å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
        </div>
        
        <div class="flex justify-end mt-6 pt-6 border-t">
            <button id="closeDetailBtn" class="px-6 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors">
                å…³é—­
            </button>
        </div>
    </div>
</div>

</body>
</html>