<!DOCTYPE html>
<html lang="zh-CN" id="htmlRoot">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<title data-i18n="completion.page_title">è€ƒè¯•å®Œæˆ - IMBA æ™ºèƒ½è€ƒè¯•ç³»ç»Ÿ</title>
<link rel="icon" type="image/x-icon" id="faviconLink" href="/favicon.ico">
<script src="https://cdn.tailwindcss.com/3.4.16"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css" rel="stylesheet">
<script>
tailwind.config = {
theme: {
extend: {
colors: {
primary: '#1A237E',
secondary: '#3F51B5'
},
fontFamily: {
'sans': ['Inter', 'system-ui', 'sans-serif']
}
}
}
}
</script>
<style>
body {
font-family: 'Inter', sans-serif;
background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
}

.completion-bg {
background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
}

.success-icon {
animation: scaleIn 0.6s ease-out;
}

@keyframes scaleIn {
0% { transform: scale(0); opacity: 0; }
50% { transform: scale(1.1); opacity: 0.8; }
100% { transform: scale(1); opacity: 1; }
}

.fade-in {
animation: fadeIn 0.8s ease-out;
}

@keyframes fadeIn {
0% { opacity: 0; transform: translateY(20px); }
100% { opacity: 1; transform: translateY(0); }
}

.button-shine {
position: relative;
overflow: hidden;
}

.button-shine::before {
content: '';
position: absolute;
top: 0;
left: -100%;
width: 100%;
height: 100%;
background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
transition: left 0.5s;
}

.button-shine:hover::before {
left: 100%;
}
</style>
</head>

<body class="completion-bg min-h-screen">
<div class="min-h-screen flex items-center justify-center px-4">
<div class="max-w-2xl w-full">
<!-- Success Icon -->
<div class="text-center mb-8">
<div class="success-icon inline-flex items-center justify-center w-24 h-24 bg-green-100 rounded-full mb-6">
<i class="ri-check-line text-4xl text-green-600"></i>
</div>
<h1 class="text-4xl font-bold text-gray-900 mb-4 fade-in" data-i18n="completion.title">è€ƒè¯•å·²å®Œæˆï¼</h1>
<p class="text-xl text-gray-600 fade-in" data-i18n="completion.congratulations">æ­å–œæ‚¨é¡ºåˆ©å®Œæˆæœ¬æ¬¡è€ƒè¯•</p>
<!-- Language Toggle -->
<button id="languageToggle" class="mt-4 text-gray-600 hover:text-primary transition-colors px-3 py-2 rounded-lg border border-gray-200">
<i class="ri-global-line mr-1"></i>
<span class="language-display">ä¸­</span>
</button>
</div>

<!-- Completion Card -->
<div class="bg-white rounded-2xl shadow-xl p-8 mb-8 fade-in">
<div class="text-center">
<div class="flex items-center justify-center mb-6">
<div class="flex items-center space-x-2 text-sm text-gray-500">
<i class="ri-time-line"></i>
<span data-i18n="completion.completion_time">å®Œæˆæ—¶é—´ï¼š</span>
<span id="completionTime" class="font-medium text-gray-900">--</span>
</div>
</div>

<div class="bg-blue-50 rounded-xl p-6 mb-6">
<div class="flex items-center justify-center mb-4">
<i class="ri-information-line text-2xl text-blue-600 mr-3"></i>
<h3 class="text-lg font-semibold text-blue-900" data-i18n="completion.notice_title">æ¸©é¦¨æç¤º</h3>
</div>
<div class="text-blue-800 space-y-2">
<p data-i18n="completion.notice1">âœ“ æ‚¨çš„ç­”æ¡ˆå·²æˆåŠŸæäº¤å¹¶ä¿å­˜</p>
<p data-i18n="completion.notice2">âœ“ ç³»ç»Ÿæ­£åœ¨å¤„ç†æ‚¨çš„ç­”å·</p>
<p data-i18n="completion.notice3">âœ“ è€ƒè¯•ç»“æœå°†åœ¨ç¨åé€šè¿‡ç›¸å…³æ¸ é“é€šçŸ¥æ‚¨</p>
</div>
</div>

<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
<div class="bg-gray-50 rounded-lg p-4 text-center">
<div class="text-2xl font-bold text-primary" id="questionCount">--</div>
<div class="text-sm text-gray-600" data-i18n="completion.total_questions">é¢˜ç›®æ€»æ•°</div>
</div>
<div class="bg-gray-50 rounded-lg p-4 text-center">
<div class="text-2xl font-bold text-green-600" id="answeredCount">--</div>
<div class="text-sm text-gray-600" data-i18n="completion.answered_questions">å·²ç­”é¢˜ç›®</div>
</div>
<div class="bg-gray-50 rounded-lg p-4 text-center">
<div class="text-2xl font-bold text-blue-600" id="timeSpent">--</div>
<div class="text-sm text-gray-600" data-i18n="completion.time_spent">ç”¨æ—¶</div>
</div>
</div>

<!-- é‡è¦è¯´æ˜ -->
<div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
<div class="flex items-start">
<i class="ri-alert-line text-yellow-600 text-xl mr-3 flex-shrink-0 mt-0.5"></i>
<div class="text-yellow-800">
<p class="font-medium mb-2" data-i18n="completion.important_notice">é‡è¦è¯´æ˜ï¼š</p>
<ul class="text-sm space-y-1">
<li data-i18n="completion.notice_item1">â€¢ æœ¬æ¬¡è€ƒè¯•å·²æ­£å¼ç»“æŸï¼Œæ— æ³•å†æ¬¡è¿›å…¥æˆ–ä¿®æ”¹ç­”æ¡ˆ</li>
<li data-i18n="completion.notice_item2">â€¢ è¯·ç­‰å¾…å®˜æ–¹é€šçŸ¥è·å–è€ƒè¯•ç»“æœ</li>
<li data-i18n="completion.notice_item3">â€¢ å¦‚æœ‰ç–‘é—®ï¼Œè¯·è”ç³»ç›¸å…³è´Ÿè´£äºº</li>
</ul>
</div>
</div>
</div>
</div>
</div>

<!-- Action Buttons -->
<div class="flex flex-col sm:flex-row gap-4 justify-center">
<button onclick="window.location.href='/'" 
class="button-shine bg-primary text-white px-8 py-3 rounded-xl font-semibold hover:bg-blue-800 transition-all duration-300 transform hover:scale-105">
<i class="ri-home-line mr-2"></i><span data-i18n="completion.back_home">è¿”å›é¦–é¡µ</span>
</button>
<button onclick="window.print()" 
class="button-shine bg-gray-600 text-white px-8 py-3 rounded-xl font-semibold hover:bg-gray-700 transition-all duration-300 transform hover:scale-105">
<i class="ri-printer-line mr-2"></i><span data-i18n="completion.print_confirmation">æ‰“å°ç¡®è®¤å•</span>
</button>
</div>

<!-- Footer -->
<div class="text-center mt-8 text-gray-500 text-sm fade-in">
<p data-i18n="completion.footer_text">æ„Ÿè°¢æ‚¨å‚ä¸æœ¬æ¬¡è€ƒè¯• | IMBA æ™ºèƒ½è€ƒè¯•ç³»ç»Ÿ</p>
</div>
</div>
</div>

<!-- å¤šè¯­è¨€æ”¯æŒè„šæœ¬ -->
<script src="/static/js/i18n.js"></script>

<script>
class CompletionPage {
constructor() {
this.examId = null;
this.instanceId = null;
this.examData = null;
this.useInstance = false;
this.init();
}

async init() {
// è·å–è€ƒè¯•IDæˆ–å®ä¾‹ID
const urlParams = new URLSearchParams(window.location.search);
this.examId = urlParams.get('exam_id');
this.instanceId = urlParams.get('instance_id');

// æ”¯æŒæ–°æ—§ä¸¤ç§æ¨¡å¼
if (!this.examId && !this.instanceId) {
console.warn('æœªæ‰¾åˆ°è€ƒè¯•IDæˆ–å®ä¾‹IDï¼Œä½¿ç”¨é»˜è®¤æ˜¾ç¤º');
this.setupDefaultDisplay();
return;
}

this.useInstance = !!this.instanceId;
await this.loadExamData();
this.setupDisplay();
}

async loadExamData() {
try {
// æ ¹æ®æ¨¡å¼è·å–è€ƒè¯•ä¿¡æ¯
const apiUrl = this.useInstance ? 
    `/api/exam-instance-status/${this.instanceId}` : 
    `/api/exam-status/${this.examId}`;
    
console.log(`åŠ è½½è€ƒè¯•æ•°æ®: ${apiUrl}`);
const response = await fetch(apiUrl);

if (response.ok) {
const data = await response.json();
console.log('APIè¿”å›æ•°æ®:', data);
if (data.success) {
this.examData = data;
console.log('âœ… æˆåŠŸåŠ è½½è€ƒè¯•æ•°æ®');
}
}
} catch (error) {
console.warn('æ— æ³•åŠ è½½è€ƒè¯•æ•°æ®:', error);
}
}

setupDisplay() {
// è®¾ç½®å®Œæˆæ—¶é—´
const completionTime = this.examData?.completed_at ? 
    new Date(this.examData.completed_at).toLocaleString('zh-CN') :
    new Date().toLocaleString('zh-CN');
document.getElementById('completionTime').textContent = completionTime;

if (this.examData) {
// æ˜¾ç¤ºçœŸå®çš„é¢˜ç›®ç»Ÿè®¡
document.getElementById('questionCount').textContent = this.examData.total_questions || '--';
document.getElementById('answeredCount').textContent = this.examData.questions_answered || '--';
document.getElementById('timeSpent').textContent = this.calculateTimeSpent();
console.log(`ğŸ“Š æ˜¾ç¤ºè€ƒè¯•ç»Ÿè®¡: ${this.examData.questions_answered}/${this.examData.total_questions} é¢˜ç›®ï¼Œç”¨æ—¶ ${this.calculateTimeSpent()}`);
} else {
this.setupDefaultDisplay();
}
}

setupDefaultDisplay() {
const now = new Date();
document.getElementById('completionTime').textContent = now.toLocaleString('zh-CN');
document.getElementById('questionCount').textContent = '5';
document.getElementById('answeredCount').textContent = '5';
document.getElementById('timeSpent').textContent = '45åˆ†é’Ÿ';
console.warn('âš ï¸ ä½¿ç”¨é»˜è®¤æ˜¾ç¤ºæ•°æ®');
}

calculateTimeSpent() {
if (this.examData && this.examData.time_spent_minutes !== undefined) {
const minutes = Math.round(this.examData.time_spent_minutes);
return minutes + 'åˆ†é’Ÿ';
}
// é»˜è®¤å€¼
return '45åˆ†é’Ÿ';
}
}

// åˆå§‹åŒ–é¡µé¢
document.addEventListener('DOMContentLoaded', async function() {
// ç­‰å¾…å¤šè¯­è¨€åˆå§‹åŒ–å®Œæˆ
if (window.i18n && !window.i18n.initialized) {
await new Promise(resolve => {
document.addEventListener('i18n:initialized', resolve, { once: true });
});
}

new CompletionPage();
});

// ç»‘å®šå¤šè¯­è¨€æ›´æ–°äº‹ä»¶
document.addEventListener('i18n:languageChanged', () => {
// é¡µé¢å†…å®¹ä¼šè‡ªåŠ¨æ›´æ–°ï¼Œè¿™é‡Œå¯ä»¥å¤„ç†ç‰¹æ®Šçš„åŠ¨æ€å†…å®¹
console.log('Language changed in completion page');
});

// é˜²æ­¢è¿”å›åˆ°è€ƒè¯•é¡µé¢
if (window.history.length > 1) {
window.history.replaceState(null, null, window.location.href);
}
</script>
</body>
</html>
