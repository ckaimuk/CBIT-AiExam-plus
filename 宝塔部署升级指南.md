# ğŸš€ å®å¡”é¢æ¿éƒ¨ç½²å‡çº§æŒ‡å— - CBITæ™ºèƒ½è€ƒè¯•ç³»ç»Ÿ

æœ¬æŒ‡å—ä¸“é—¨é’ˆå¯¹å®å¡”é¢æ¿ç¯å¢ƒçš„éƒ¨ç½²å’Œå‡çº§ï¼Œä¿®å¤é¢˜ç›®ç­›é€‰åŠŸèƒ½ã€‚

## ğŸ“‹ å‡çº§å‰å‡†å¤‡

### 1. ç³»ç»Ÿè¦æ±‚
- å®å¡”é¢æ¿ 7.0+
- Docker å’Œ Docker Compose å·²å®‰è£…
- ç³»ç»Ÿå†…å­˜ >= 2GB
- ç£ç›˜ç©ºé—´ >= 10GB

### 2. æ£€æŸ¥ç°æœ‰éƒ¨ç½²
ç™»å½•å®å¡”é¢æ¿ï¼Œæ£€æŸ¥ï¼š
- ğŸ“ é¡¹ç›®æ˜¯å¦åœ¨ `/www/wwwroot/cbit-autoexam/`
- ğŸ³ Docker å®¹å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œ
- ğŸ“Š å½“å‰æ•°æ®åº“ä½ç½®

## ğŸš€ å¿«é€Ÿå‡çº§æ–¹æ³•

### æ–¹æ³•ä¸€ï¼šSSHç»ˆç«¯å‡çº§ï¼ˆæ¨èï¼‰

1. **é€šè¿‡å®å¡”é¢æ¿è¿›å…¥ç»ˆç«¯**
   ```bash
   # è¿›å…¥é¡¹ç›®ç›®å½•
   cd /www/wwwroot/cbit-autoexam/
   
   # æŸ¥çœ‹å½“å‰çŠ¶æ€
   git status
   docker ps
   ```

2. **æ‹‰å–æœ€æ–°ä»£ç **
   ```bash
   # å¤‡ä»½æœ¬åœ°ä¿®æ”¹ï¼ˆå¦‚æœæœ‰ï¼‰
   git stash
   
   # æ‹‰å–æœ€æ–°ä»£ç 
   git pull origin main
   ```

3. **è¿è¡Œä¸“ç”¨å‡çº§è„šæœ¬**
   ```bash
   # ç»™è„šæœ¬æ‰§è¡Œæƒé™
   chmod +x upgrade_fix.sh
   
   # è¿è¡Œå‡çº§è„šæœ¬
   ./upgrade_fix.sh
   ```

### æ–¹æ³•äºŒï¼šä½¿ç”¨å®å¡”æ–‡ä»¶ç®¡ç†å™¨

å¦‚æœSSHä¸å¯ç”¨ï¼Œå¯ä»¥é€šè¿‡æ–‡ä»¶ç®¡ç†å™¨ï¼š

1. **ä¸‹è½½æœ€æ–°ä»£ç **
   - åœ¨GitHubä¸‹è½½æœ€æ–°çš„ä»£ç ZIPåŒ…
   - é€šè¿‡å®å¡”æ–‡ä»¶ç®¡ç†å™¨ä¸Šä¼ å¹¶è§£å‹

2. **æ‰‹åŠ¨æ‰§è¡Œå‡çº§**
   ```bash
   # åœ¨å®å¡”ç»ˆç«¯ä¸­æ‰§è¡Œ
   cd /www/wwwroot/cbit-autoexam/
   chmod +x upgrade_fix.sh
   ./upgrade_fix.sh
   ```

## ğŸ› ï¸ å®å¡”ä¸“ç”¨é…ç½®

### 1. ä½¿ç”¨å®å¡”ä¸“ç”¨composeæ–‡ä»¶

é¡¹ç›®åŒ…å«ä¸“é—¨çš„å®å¡”é…ç½®æ–‡ä»¶ï¼š`docker-compose.bt.yml`

```yaml
# å®å¡”ä¸“ç”¨é…ç½®ç‰¹ç‚¹ï¼š
- ç«¯å£æ˜ å°„ï¼š8080:8080
- æ•°æ®æŒä¹…åŒ–ï¼š/srv/yourapp/data:/data
- æ—¥å¿—ç®¡ç†ï¼šé™åˆ¶å¤§å°å’Œæ–‡ä»¶æ•°
- ç½‘ç»œé…ç½®ï¼šä¸“ç”¨ç½‘ç»œ
```

### 2. åˆ›å»ºå®å¡”ç«™ç‚¹ï¼ˆå¯é€‰ï¼‰

å¦‚æœè¦é€šè¿‡åŸŸåè®¿é—®ï¼š

1. **åœ¨å®å¡”é¢æ¿åˆ›å»ºç«™ç‚¹**
   - åŸŸåï¼š`your-domain.com`
   - æ ¹ç›®å½•ï¼š`/www/wwwroot/cbit-autoexam/frontend`
   - PHPç‰ˆæœ¬ï¼šæ— éœ€PHP

2. **é…ç½®åå‘ä»£ç†**
   - ç›®æ ‡URLï¼š`http://127.0.0.1:8080`
   - å‘é€åŸŸåï¼š`$host`
   - å¯ç”¨ç¼“å­˜ï¼šå¦

## ğŸ“‚ å®å¡”ç¯å¢ƒç›®å½•ç»“æ„

å‡çº§åçš„æ ‡å‡†ç›®å½•ç»“æ„ï¼š

```
/www/wwwroot/cbit-autoexam/           # é¡¹ç›®æ ¹ç›®å½•
â”œâ”€â”€ frontend/                        # å‰ç«¯æ–‡ä»¶
â”œâ”€â”€ backend/                         # åç«¯ä»£ç 
â”œâ”€â”€ database/                        # æ•°æ®åº“è„šæœ¬
â”œâ”€â”€ docker-compose.bt.yml            # å®å¡”ä¸“ç”¨composeæ–‡ä»¶
â”œâ”€â”€ upgrade_fix.sh                   # å‡çº§è„šæœ¬
â””â”€â”€ å®å¡”éƒ¨ç½²å‡çº§æŒ‡å—.md               # æœ¬æ–‡æ¡£

/srv/yourapp/data/                   # æ•°æ®å­˜å‚¨ç›®å½•
â”œâ”€â”€ app.db                          # ä¸»æ•°æ®åº“æ–‡ä»¶
â”œâ”€â”€ app_backup_YYYYMMDD.db          # è‡ªåŠ¨å¤‡ä»½
â””â”€â”€ logs/                           # æ—¥å¿—æ–‡ä»¶

/www/wwwroot/cbit-autoexam/logs/     # åº”ç”¨æ—¥å¿—
â”œâ”€â”€ access.log                      # è®¿é—®æ—¥å¿—
â”œâ”€â”€ error.log                       # é”™è¯¯æ—¥å¿—
â””â”€â”€ nginx/                          # Nginxæ—¥å¿—
```

## ğŸ”§ å®å¡”é¢æ¿ç‰¹æ®Šæ“ä½œ

### 1. é€šè¿‡å®å¡”ç®¡ç†Docker

**æŸ¥çœ‹å®¹å™¨çŠ¶æ€**ï¼š
- å®å¡”é¢æ¿ â†’ Dockerç®¡ç†å™¨ â†’ å®¹å™¨åˆ—è¡¨
- æŸ¥æ‰¾ `cbit-autoexam` å®¹å™¨

**é‡å¯å®¹å™¨**ï¼š
```bash
# åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œ
cd /www/wwwroot/cbit-autoexam/
docker-compose -f docker-compose.bt.yml restart
```

**æŸ¥çœ‹æ—¥å¿—**ï¼š
```bash
# å®¹å™¨æ—¥å¿—
docker logs cbit-autoexam

# åº”ç”¨æ—¥å¿—
tail -f logs/error.log
```

### 2. è®¾ç½®å®šæ—¶ä»»åŠ¡ï¼ˆå¯é€‰ï¼‰

åœ¨å®å¡”é¢æ¿è®¾ç½®å®šæ—¶å¤‡ä»½ï¼š

**æ•°æ®åº“å¤‡ä»½ä»»åŠ¡**ï¼š
```bash
# ä»»åŠ¡ç±»å‹ï¼šShellè„šæœ¬
# æ‰§è¡Œå‘¨æœŸï¼šæ¯å¤©å‡Œæ™¨2ç‚¹
# è„šæœ¬å†…å®¹ï¼š
cp /srv/yourapp/data/app.db /srv/yourapp/data/backup/app_$(date +%Y%m%d).db
find /srv/yourapp/data/backup/ -name "app_*.db" -mtime +7 -delete
```

### 3. é˜²ç«å¢™é…ç½®

ç¡®ä¿åœ¨å®å¡”é¢æ¿å¼€æ”¾ç«¯å£ï¼š
- ç«¯å£ï¼š`8080`
- ç±»å‹ï¼šTCP
- è¯´æ˜ï¼šCBITæ™ºèƒ½è€ƒè¯•ç³»ç»Ÿ

## ğŸš€ ä¸€é”®éƒ¨ç½²è„šæœ¬ï¼ˆå®å¡”ç‰ˆï¼‰

åˆ›å»ºå®å¡”ä¸€é”®éƒ¨ç½²è„šæœ¬ï¼š

```bash
# åˆ›å»ºéƒ¨ç½²è„šæœ¬
cat > /www/wwwroot/deploy_cbit.sh << 'EOF'
#!/bin/bash
echo "ğŸš€ å®å¡”ç¯å¢ƒCBITæ™ºèƒ½è€ƒè¯•ç³»ç»Ÿä¸€é”®éƒ¨ç½²"

# æ£€æŸ¥Docker
if ! command -v docker &> /dev/null; then
    echo "âŒ Dockeræœªå®‰è£…ï¼Œè¯·å…ˆåœ¨å®å¡”é¢æ¿å®‰è£…Docker"
    exit 1
fi

# åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir -p /www/wwwroot/cbit-autoexam
cd /www/wwwroot/cbit-autoexam

# å…‹éš†ä»£ç 
git clone https://github.com/reneverland/CBIT-AiExam-plus.git .

# åˆ›å»ºæ•°æ®ç›®å½•
mkdir -p /srv/yourapp/data
chmod -R 777 /srv/yourapp/data

# è¿è¡Œå‡çº§è„šæœ¬
chmod +x upgrade_fix.sh
./upgrade_fix.sh

echo "âœ… éƒ¨ç½²å®Œæˆï¼"
echo "ğŸŒ è®¿é—®åœ°å€: http://$(curl -s ifconfig.me):8080"
echo "ğŸ“± ç®¡ç†åå°: http://$(curl -s ifconfig.me):8080/admin/dashboard"
EOF

chmod +x /www/wwwroot/deploy_cbit.sh
```

## ğŸ” éªŒè¯éƒ¨ç½²ç»“æœ

### 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€

**åœ¨å®å¡”é¢æ¿æ£€æŸ¥**ï¼š
- Dockerç®¡ç†å™¨ â†’ å®¹å™¨åˆ—è¡¨ â†’ `cbit-autoexam` çŠ¶æ€ä¸ºè¿è¡Œä¸­
- è¿›ç¨‹ç®¡ç† â†’ æŸ¥çœ‹ç›¸å…³è¿›ç¨‹

**å‘½ä»¤è¡Œæ£€æŸ¥**ï¼š
```bash
# æ£€æŸ¥å®¹å™¨
docker ps | grep cbit

# æ£€æŸ¥ç«¯å£
netstat -tlnp | grep 8080

# æ£€æŸ¥æ•°æ®åº“
ls -la /srv/yourapp/data/
```

### 2. æµ‹è¯•è®¿é—®

- ğŸŒ **ä¸»é¡µ**ï¼š`http://æœåŠ¡å™¨IP:8080`
- ğŸ“‹ **é¢˜åº“ç®¡ç†**ï¼š`http://æœåŠ¡å™¨IP:8080/question_management.html`
- ğŸ› ï¸ **ç®¡ç†åå°**ï¼š`http://æœåŠ¡å™¨IP:8080/admin/dashboard`

**é»˜è®¤ç®¡ç†å‘˜è´¦å·**ï¼š
- ç”¨æˆ·åï¼š`admin`
- å¯†ç ï¼š`imbagogo`

### 3. éªŒè¯ç­›é€‰åŠŸèƒ½

1. è¿›å…¥é¢˜åº“ç®¡ç†é¡µé¢
2. æµ‹è¯•å„ä¸ªç­›é€‰å™¨ï¼š
   - âœ… å­¦ç§‘ç­›é€‰ï¼šæ•°å­¦ã€è®¡ç®—æœºç§‘å­¦ã€ç»Ÿè®¡å­¦ã€å·¥ç¨‹å­¦
   - âœ… éš¾åº¦ç­›é€‰ï¼šé«˜ä¸­æ°´å¹³ã€æœ¬ç§‘åŸºç¡€ã€æœ¬ç§‘é«˜çº§ã€ç ”ç©¶ç”Ÿæ°´å¹³
   - âœ… é¢˜å‹ç­›é€‰ï¼šé€‰æ‹©é¢˜ã€ç®€ç­”é¢˜ã€ç¼–ç¨‹é¢˜
3. éªŒè¯ç»„åˆç­›é€‰åŠŸèƒ½

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. å®¹å™¨å¯åŠ¨å¤±è´¥
```bash
# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
docker logs cbit-autoexam

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep 8080

# é‡æ–°æ„å»º
cd /www/wwwroot/cbit-autoexam/
docker-compose -f docker-compose.bt.yml down
docker-compose -f docker-compose.bt.yml up -d --force-recreate
```

#### 2. æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶
ls -la /srv/yourapp/data/app.db

# ä¿®å¤æƒé™
chmod 777 /srv/yourapp/data/app.db

# é‡æ–°è¿è¡Œä¿®å¤è„šæœ¬
python3 database/fix_filter_tags.py
```

#### 3. ç­›é€‰åŠŸèƒ½ä¸å·¥ä½œ
```bash
# é‡æ–°è¿è¡Œæ ‡ç­¾ä¿®å¤
cd /www/wwwroot/cbit-autoexam/
python3 database/fix_filter_tags.py

# é‡å¯å®¹å™¨
docker-compose -f docker-compose.bt.yml restart
```

#### 4. å®å¡”é¢æ¿è®¿é—®é—®é¢˜
- æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦å¼€æ”¾8080ç«¯å£
- æ£€æŸ¥å®å¡”å®‰å…¨è§„åˆ™
- ç¡®è®¤æœåŠ¡å™¨å®‰å…¨ç»„é…ç½®

### å›æ»šæ–¹æ¡ˆ

å¦‚æœå‡çº§å‡ºç°é—®é¢˜ï¼š

```bash
# 1. åœæ­¢æœåŠ¡
docker-compose -f docker-compose.bt.yml down

# 2. æ¢å¤æ•°æ®åº“
cp /srv/yourapp/data/app_backup_YYYYMMDD.db /srv/yourapp/data/app.db

# 3. å›æ»šä»£ç 
git checkout HEAD~1

# 4. é‡å¯æœåŠ¡
docker-compose -f docker-compose.bt.yml up -d
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### å®å¡”é¢æ¿ç›¸å…³é—®é¢˜
- æŸ¥çœ‹å®å¡”é¢æ¿æ—¥å¿—ï¼šé¢æ¿è®¾ç½® â†’ é¢æ¿æ—¥å¿—
- Dockeré—®é¢˜ï¼šè½¯ä»¶å•†åº— â†’ Dockerç®¡ç†å™¨ â†’ è®¾ç½®
- ç«¯å£é—®é¢˜ï¼šå®‰å…¨ â†’ é˜²ç«å¢™ â†’ æ·»åŠ ç«¯å£è§„åˆ™

### åº”ç”¨ç›¸å…³é—®é¢˜
- åº”ç”¨æ—¥å¿—ï¼š`/www/wwwroot/cbit-autoexam/logs/`
- å®¹å™¨æ—¥å¿—ï¼š`docker logs cbit-autoexam`
- æ•°æ®åº“æ£€æŸ¥ï¼šç›´æ¥è®¿é—® `/srv/yourapp/data/app.db`

## âœ… æˆåŠŸéƒ¨ç½²æ£€æŸ¥æ¸…å•

å‡çº§å®Œæˆåï¼Œç¡®è®¤ä»¥ä¸‹é¡¹ç›®ï¼š

- [ ] å®å¡”é¢æ¿èƒ½çœ‹åˆ°è¿è¡Œä¸­çš„Dockerå®¹å™¨
- [ ] æµè§ˆå™¨èƒ½æ­£å¸¸è®¿é—® `http://IP:8080`
- [ ] ç®¡ç†å‘˜èƒ½æ­£å¸¸ç™»å½•åå°
- [ ] é¢˜åº“ç®¡ç†é¡µé¢çš„ç­›é€‰åŠŸèƒ½æ­£å¸¸
- [ ] æ•°æ®åº“æ–‡ä»¶ä½äº `/srv/yourapp/data/app.db`
- [ ] é˜²ç«å¢™å·²å¼€æ”¾8080ç«¯å£
- [ ] æ‰€æœ‰é¢˜ç›®æ•°æ®å®Œæ•´ä¿ç•™

ğŸ‰ **æ­å–œï¼æ‚¨çš„å®å¡”ç¯å¢ƒCBITæ™ºèƒ½è€ƒè¯•ç³»ç»Ÿå‡çº§æˆåŠŸï¼**

## ğŸ”— ç›¸å…³é“¾æ¥

- ğŸ“Š **GitHubä»“åº“**ï¼šhttps://github.com/reneverland/CBIT-AiExam-plus
- ğŸ“š **é€šç”¨å‡çº§æŒ‡å—**ï¼š`SERVER_UPGRADE_GUIDE.md`
- ğŸ³ **Dockeré…ç½®**ï¼š`docker-compose.bt.yml`
- ğŸ› ï¸ **å‡çº§è„šæœ¬**ï¼š`upgrade_fix.sh`
